[
    {
        "id": "cbd68ba9caa96a3d",
        "type": "tab",
        "label": "Timer",
        "disabled": false,
        "info": "Send messages through a `link out` node named _time_ to drive home automation based on the time of day. Messages will be sent five times during each 24 hour period. Each such message will have `msg.payload` set to a JavaScript object with two properties:\n\n| Property            | Description                                                             |\n|---------------------|-------------------------------------------------------------------------|\n| `msg.payload.time`  | One of five string values specifying a time of day, as described below  |\n| `msg.payload.theme` | One of four string values specifying a time of year, as described below |\n\n### Configuration\n\nThis flow contains a `function` node that uses the [suncalc](https://github.com/mourner/suncalc) package and relies on `LATITUDE` and `LONGITUDE` environment variables to specify the geographic coordinates used in determining sunrise and sunset.\n\n> Geographic coordinates are an example of sensitive personal information that should generally be kept out of flows that might be shared as examples in a forum, pushed to a public source control repository etc.\n\n> You can specify environment variables for use in your flows in a number of ways, depending on your preferences and your overall Node-RED configuration. For most \"mainstream\" scenarios, the simplest way is to add them to the _~/.node-red/environment_ file in the home directory of the user as whom the Node-RED service is running.\n\n### Time of Day\n\n| `msg.payload.time` | Descrption                                                                            |\n|--------------------|---------------------------------------------------------------------------------------|\n| `morning`          | Sunrise to two hours before the sun has reached its highest altitude                  |\n| `midday`           | The four hours surrounding the time at which the sun has reached its highest altitude |\n| `afternoon`        | Two hours after the sun has reached its highest altitude to sunset                    |\n| `evening`          | Sunset to _bedtime_                                                                   |\n| `night`            | _Bedtime_ to sunrise                                                                  |\n\n_Offset_ is one third of the number of hours between sunrise and sunset.\n\n_Bedtime_ is generated each day to occur at the later of:\n\n- 10:00PM (22:00), plus or minus a randomly generated 30 minute offset\n- a randomly generated time, 30 to 60 minutes after sunset\n\n> Five distinct times of day may seem excessive, but has proven necessary in a number of real-world scenarios. For example, the distinctions between `morning`, `midday` and `afternoon` are invaluable for homes with automated coverings over both East- and West-facing windows. In addition, randomizing `bedtime` can provide a modest degree of \"simulated presence\" to discourage potential burglars.\n\n### Theme\n\nIn addition to the time-of-day specified by `msg.payload.time`, as described above, automation flows can also assume that `msg.payload.theme` will have been set to a value indicating any special occasions that might be effect:\n\n| `msg.payload.theme` | Description                           |\n|---------------------|---------------------------------------|\n| `tribal`            | July 1 - 4 (US Independence Day)      |\n| `spooky`            | Any day in October (Halloween)        |\n| `jolly`             | Any day in December (Winter Solstice) |\n| `standard`          | Any other day                         |\n",
        "env": []
    },
    {
        "id": "ff0141ba0f0c7234",
        "type": "tab",
        "label": "Automation",
        "disabled": false,
        "info": "Change the flows inside the groups \"lighting automation\" and \"window shade automation\" according to your desired behavior for your hardware setup",
        "env": []
    },
    {
        "id": "c7141ffb22d64190",
        "type": "tab",
        "label": "Ground Floor Hue",
        "disabled": false,
        "info": "There should be a flow similar to this tab for each Hue Bridge you wish to control.\n\n### Configuration\n\nThe subflows on this tab assume the following configuration:\n\n| Environment Variable | Description                                                                     |\n|----------------------|---------------------------------------------------------------------------------|\n| `ADDRESS`            | IP address or host name of the Hue Bridge                                       |\n| `KEY`                | The client application key to use when invoking the Hue API                     |\n| `TOPIC`              | The base topic to prepend to each server-sent event forwarded as a MQTT message |\n\nUse the `inject` node named _create key_ within 30 seconds of pressing the button on top of the Hue Bridge to generate a value to use for `${KEY}`.\n\n### Details\n\nChange the flows inside the groups labeled _Main Floor_, _Main Bathroom_ and _Yard_ to match your desired behavior for your hardware setup."
    },
    {
        "id": "810a8b527afd2b1b",
        "type": "tab",
        "label": "Basement Hue",
        "disabled": false,
        "info": "There should be a flow similar to this tab for each Hue Bridge you wish to control.\n\n### Configuration\n\nThe subflows on this tab assume the following configuration:\n\n| Environment Variable | Description                                                                     |\n|----------------------|---------------------------------------------------------------------------------|\n| `ADDRESS`            | IP address or host name of the Hue Bridge                                       |\n| `KEY`                | The client application key to use when invoking the Hue API                     |\n| `TOPIC`              | The base topic to prepend to each server-sent event forwarded as a MQTT message |\n\nUse the `inject` node named _create key_ within 30 seconds of pressing the button on top of the Hue Bridge to generate a value to use for `${KEY}`.\n",
        "env": []
    },
    {
        "id": "1cf0490e7de2f93d",
        "type": "tab",
        "label": "PowerView",
        "disabled": false,
        "info": "### Configuration\n\nThe subflows on this tab assume that `${ADDRESS}` is set to the IP address or host name of the PowerView hub.\n\n### Details\n\nChange the flows inside the groups labeled _close all shades_, _open all shades_, open east shades, close west shades_ and _close east shades, open west shades_ to match your desired behavior for your hardware setup.",
        "env": [
            {
                "name": "ADDRESS",
                "value": "POWERVIEW_ADDRESS",
                "type": "env"
            }
        ]
    },
    {
        "id": "b12fd38c090c51f2",
        "type": "tab",
        "label": "Dashboard",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "5785c8d9f39df67e",
        "type": "subflow",
        "name": "Send to Hue Bridge",
        "info": "# Overview\n\nSend a message to the API (version 2) on a given Hue Bridge.\n\nSee <https://developers.meethue.com/develop/hue-api-v2/> for details.\n\n_**Note:** the intent is for this subflow to be used for_ every _message sent to a given Hue bridge so as to enforce the rate limits described in the Hue API documentation._\n\n# Configuration\n\n| Environment Variable | Description                         |\n|----------------------|-------------------------------------|\n| `ADDRESS`            | Bridge's IP address                 |\n| `KEY`                | Client access token for the message |\n\n# Input\n\n| Message Property | Description                                                                |\n|------------------|----------------------------------------------------------------------------|\n| `msg.topic`      | API URI, e.g. `resource`, `room/0ca8f049-7ac9-4872-8069-4770834e4f11` etc. |\n| `msg.payload`    | Request body, if any                                                       |\n| `msg.method`     | HTTP request method, e.g. `GET`, `PUT` etc                                 |\n\n# Outputs\n\nIf successful, the HTTP response will be sent as a parsed JSON object in `msg.payload` from output 1.\n\nA standard Node-RED error message will be sent on output 2 if the `http request` node throws an exception.",
        "category": "hue",
        "in": [
            {
                "x": 60,
                "y": 60,
                "wires": [
                    {
                        "id": "fa870f94fa1ea10b"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 850,
                "y": 60,
                "wires": [
                    {
                        "id": "c029fcaa62306eb2",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [
            {
                "name": "ADDRESS",
                "type": "str",
                "value": ""
            },
            {
                "name": "KEY",
                "type": "str",
                "value": ""
            }
        ],
        "meta": {
            "module": "@parasaurolophus/node-red-send-to-hue-bridge",
            "type": "send-to-hue-bridge",
            "version": "1.0.0",
            "author": "parasaurolophus <apps@rader.us>",
            "desc": "Send a command to the Hue Bridge API",
            "keywords": "philips,hue,http",
            "license": "MIT"
        },
        "color": "#AA77AA",
        "outputLabels": [
            "error"
        ],
        "icon": "font-awesome/fa-lightbulb-o",
        "status": {
            "x": 820,
            "y": 140,
            "wires": [
                {
                    "id": "1e35b6e766e6b3d1",
                    "port": 0
                }
            ]
        }
    },
    {
        "id": "75bc72a16c4da2c8",
        "type": "subflow",
        "name": "Create Hue Application Key",
        "info": "# Overview\n\nInvoke the Hue Bridge API to create a client access token.\n\n_**N.B.:** Invoke this subflow within 30 seconds of pressing the button on top of the bridge. Watch the debug console output to see the response. If successful, you will see the generated key among the response payload's properties._\n\nSee <https://developers.meethue.com/develop/hue-api-v2/getting-started/> for details.\n\n# Configuration\n\n| Environment Variable | Description                                    |\n|----------------------|------------------------------------------------|\n|`ADDRESS`             | Bridge's IP address                            |\n| `USERNAME`           | \"User name\" for which a key is being generated |\n\n# Input\n\nIncoming message triggers HTTP request but is otherwise ignored.\n\n# Output\n\nThe HTTP response will be sent as a parsed JSON object. If successful, look for the value of the `msg.payload.success.username` property in the output. That is the string you should use as the access token header in all subsequent Hue Bridge API request messages.",
        "category": "hue",
        "in": [
            {
                "x": 40,
                "y": 40,
                "wires": [
                    {
                        "id": "7316ae1eef4c6295"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 420,
                "y": 40,
                "wires": [
                    {
                        "id": "e4718ecfdb248cc7",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [
            {
                "name": "ADDRESS",
                "type": "str",
                "value": ""
            },
            {
                "name": "USERNAME",
                "type": "str",
                "value": ""
            }
        ],
        "meta": {
            "module": "@parasaurolophus/node-red-create-hue-application-key",
            "type": "create-hue-application-key",
            "version": "1.0.0",
            "author": "parasaurolophus <apps@rader.us>",
            "desc": "Invoke the Hue Bridge API for registering a client",
            "keywords": "philips,hue,http",
            "license": "MIT"
        },
        "color": "#AA77AA",
        "icon": "font-awesome/fa-lightbulb-o",
        "status": {
            "x": 420,
            "y": 100,
            "wires": [
                {
                    "id": "64ad1b43047cb836",
                    "port": 0
                }
            ]
        }
    },
    {
        "id": "9c4e4702e4660adf",
        "type": "subflow",
        "name": "Activate PowerView Scene",
        "info": "# Overview\n\nUse the _Hunter Douglas PowerView_&reg; hub API to activate a given window shade scene.\n\nSee <https://motorisation.hde.nl/hd/powerview/general-guides/API/> for details.\n\n# Configuration\n\nThe `ADDRESS` environment variable must be configured with the IP address of the hub.\n\n# Input\n\n`msg.payload` containing the id of the scene to activate.\n\nAll other input message properties are ignored by the subflow but care should be taken not to pass any through that could affect the behavior of a `http request` node in unintended ways.\n\n# Output\n\nHTTP response from the hub.\n\n# Side Effects\n\nIf successful, the window shades will move to the settings defined by the specified scene as configured using the _PowerView_&reg; mobile app.",
        "category": "powerview",
        "in": [
            {
                "x": 60,
                "y": 60,
                "wires": [
                    {
                        "id": "dcd553804e687131"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 790,
                "y": 60,
                "wires": [
                    {
                        "id": "9537c5c46c84bb18",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [
            {
                "name": "ADDRESS",
                "type": "str",
                "value": ""
            }
        ],
        "meta": {
            "module": "@parasaurolophus/node-red-set-powerview-scene",
            "type": "set-powerview-scene",
            "version": "1.0.0",
            "author": "parasaurolophus <apps@rader.us>",
            "desc": "Activate a PowerView scene",
            "keywords": "hunter douglas,powerview",
            "license": "MIT"
        },
        "color": "#C0DEED",
        "outputLabels": [
            "error"
        ],
        "icon": "font-awesome/fa-align-justify",
        "status": {
            "x": 760,
            "y": 140,
            "wires": [
                {
                    "id": "728ab503eb1eb941",
                    "port": 0
                }
            ]
        }
    },
    {
        "id": "4920eed654c67f8d",
        "type": "subflow",
        "name": "Request PowerView Metadata",
        "info": "",
        "category": "powerview",
        "in": [
            {
                "x": 60,
                "y": 80,
                "wires": [
                    {
                        "id": "465f820637e0f695"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1160,
                "y": 60,
                "wires": [
                    {
                        "id": "0d25b700ae988fbe",
                        "port": 0
                    }
                ]
            },
            {
                "x": 1150,
                "y": 120,
                "wires": [
                    {
                        "id": "0d25b700ae988fbe",
                        "port": 1
                    }
                ]
            }
        ],
        "env": [
            {
                "name": "ADDRESS",
                "type": "str",
                "value": ""
            }
        ],
        "meta": {
            "module": "@parasaurolophus/node-red-request-powerview-metadata",
            "type": "request-powerview-metadata",
            "version": "1.0.0",
            "author": "parasaurolophus <apps@rader.us>",
            "desc": "Send a request to a PowerView hub to get metadata for a room or scene",
            "keywords": "powerview,hunter douglas",
            "license": "MIT"
        },
        "color": "#C0DEED",
        "outputLabels": [
            "response",
            "error"
        ],
        "icon": "font-awesome/fa-align-justify",
        "status": {
            "x": 1120,
            "y": 240,
            "wires": [
                {
                    "id": "014121091f945d16",
                    "port": 0
                }
            ]
        }
    },
    {
        "id": "4e89e7c952d56c09",
        "type": "subflow",
        "name": "Hue to MQTT",
        "info": "# Overview\n\nThis subflow:\n\n- Caches the state of Philips Hue devices in flow context using the response  to an invocation of the `/resource` end-point of the [Philips Hue Bridge V2 API](https://developers.meethue.com/develop/hue-api-v2/api-reference/#resource).\n\n- Outputs a stream of individual event messages as the cached devices' states change by subscribing to [SSE messages](https://developers.meethue.com/develop/hue-api-v2/core-concepts/#events).\n\nEach event message will have appropriate MQTT topic, QoS and retain properties set in addition to the payload sent by the Hue bridge.\n\n_**Note:** the `switch` node named \"filter resources\" in this subflow is used to restrict the number of messages processed at startup to only those types of resources likely to be of interest to Node-RED based automation. This means that over time you will receive SSE messages for resources whose state did not appear in the initial output from this subflow. If you wish for 100% consistency across all resource types, remove the \"filter resources\" node from between the two `split` nodes, but be warned that will cause a much larger volume of MQTT messaging each time your flows are restarted._\n\n# Dependency\n\n[node-red-contrib-sse-client](https://flows.nodered.org/node/node-red-contrib-sse-client)\n\n# Configuration\n\nA separate subflow instance can be created for each Hue bridge by using the following configuration variables:\n\n| Environment Variable | Description                                                             |\n|----------------------|-------------------------------------------------------------------------|\n| `ADDRESS`            | IP address of the Hue bridge                                            |\n| `KEY`                | \"Client key\" for the Hue bridge API<sup>*</sup>                         |\n| `TOPIC`              | String to prepend to each `msg.topic` in the output, as described below |\n\n<sup>*</sup>_See <https://developers.meethue.com/develop/hue-api-v2/getting-started/> for details. Use the_ Create Hue Access Token _subflow to obtain such a key._\n\n# Input\n\nResponse from a successful call to the `/resource` end-point of the [Philips Hue Bridge V2 API](https://developers.meethue.com/develop/hue-api-v2/api-reference/#resource) in `msg.payload`.\n\n# Output\n\nAn ongoing sequence of message objects representing the state of each device as reported by [SSE](https://developers.meethue.com/develop/hue-api-v2/core-concepts/#events). Each message will have the following properties set:\n\n| Property | Value |\n|-|-|\n| `msg.topic` | `${TOPIC}/<type>/<id>` where `<type>` and `<id>` are the identifiers for a given \"resource\" as reported by the Hue bridge API. |\n| `msg.qos` | 2 |\n| `msg.retain` | `true` |\n| `msg.payload` | The current state of the given \"resource\"<sup>**</sup> |\n\n<sup>**</sup>_Note that each output message will contain a combined set of properties for each \"resource\" received across multiple API responses and SSE messages. This mitigates one of the many issues with the design of the Philips Hue API. The cached state is maintained in flow context at runtime and as retained MQTT messages across reboots._",
        "category": "hue",
        "in": [],
        "out": [
            {
                "x": 1250,
                "y": 140,
                "wires": [
                    {
                        "id": "7972bbcf134f786b",
                        "port": 0
                    },
                    {
                        "id": "f3d6eb631a33249c",
                        "port": 0
                    },
                    {
                        "id": "1bf87f4377d87af1",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [
            {
                "name": "ADDRESS",
                "type": "str",
                "value": ""
            },
            {
                "name": "KEY",
                "type": "str",
                "value": ""
            },
            {
                "name": "TOPIC",
                "type": "str",
                "value": ""
            }
        ],
        "meta": {
            "module": "@parasaurolophus/node-red-hue-to-mqtt",
            "type": "hue-to-mqtt",
            "version": "1.0.0",
            "author": "parasaurolophus <apps@rader.us>",
            "desc": "Forward SSE events arising from the Hue Bridge API to MQTT",
            "keywords": "philips,hue,sse",
            "license": "MIT"
        },
        "color": "#AA77AA",
        "outputLabels": [
            "mqtt"
        ],
        "icon": "font-awesome/fa-lightbulb-o",
        "status": {
            "x": 780,
            "y": 340,
            "wires": [
                {
                    "id": "35fad88b119f8f36",
                    "port": 0
                }
            ]
        }
    },
    {
        "id": "de620fed3bdb7aa9",
        "type": "subflow",
        "name": "Server-Side Events",
        "info": "",
        "category": "waubesa",
        "in": [
            {
                "x": 660,
                "y": 80,
                "wires": [
                    {
                        "id": "eef1022d50fc9776"
                    },
                    {
                        "id": "df7f3018ef95e2a2"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1220,
                "y": 40,
                "wires": [
                    {
                        "id": "4490a15746b1ed6b",
                        "port": 0
                    }
                ]
            },
            {
                "x": 1240,
                "y": 200,
                "wires": [
                    {
                        "id": "07b7cd7585d17a91",
                        "port": 0
                    }
                ]
            },
            {
                "x": 1260,
                "y": 260,
                "wires": [
                    {
                        "id": "92bf347e01bdb9bd",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [
            {
                "name": "TIMEOUT",
                "type": "num",
                "value": "60000"
            }
        ],
        "meta": {
            "module": "@parasaurolophus/node-red-server-side-events",
            "type": "server-side-events",
            "version": "1.0.0",
            "author": "parasaurolophus <apps@rader.us>",
            "desc": "Add watchdog timer to @parasaurolophus/node-red-eventsource",
            "keywords": "sse,eventsource",
            "license": "MIT"
        },
        "color": "#E7E7AE",
        "outputLabels": [
            "sse",
            "onopen",
            "onerror"
        ],
        "icon": "node-red/white-globe.svg",
        "status": {
            "x": 200,
            "y": 280,
            "wires": [
                {
                    "id": "d901234fd1fce55c",
                    "port": 0
                }
            ]
        }
    },
    {
        "id": "4b1f9e8c23fa098d",
        "type": "subflow",
        "name": "Parse Hue Event",
        "info": "",
        "category": "hue",
        "in": [
            {
                "x": 60,
                "y": 100,
                "wires": [
                    {
                        "id": "11642f950d52a63f"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 900,
                "y": 60,
                "wires": [
                    {
                        "id": "c4f2d5d0acdf4cc1",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {
            "module": "@parasaurolophus/node-red-parse-hue-event",
            "type": "parse-hue-event",
            "version": "1.0.0",
            "author": "parasaurolophus <apps@rader.us>",
            "desc": "Parse a raw Philips Hue bridge server-sent event",
            "keywords": "philips,hue,sse",
            "license": "MIT"
        },
        "color": "#AA77AA",
        "inputLabels": [
            "raw sse"
        ],
        "outputLabels": [
            "hue event"
        ],
        "icon": "font-awesome/fa-lightbulb-o",
        "status": {
            "x": 1040,
            "y": 140,
            "wires": [
                {
                    "id": "612b03cff3e03da9",
                    "port": 0
                }
            ]
        }
    },
    {
        "id": "9601cbf2386d897b",
        "type": "subflow",
        "name": "Count Messages",
        "info": "",
        "category": "waubesa",
        "in": [],
        "out": [
            {
                "x": 730,
                "y": 60,
                "wires": [
                    {
                        "id": "29db695f97cc5757",
                        "port": 0
                    }
                ]
            },
            {
                "x": 730,
                "y": 140,
                "wires": [
                    {
                        "id": "29db695f97cc5757",
                        "port": 1
                    }
                ]
            }
        ],
        "env": [
            {
                "name": "TOPIC",
                "type": "str",
                "value": ""
            }
        ],
        "meta": {
            "module": "@parasaurolophus/node-red-count-messages",
            "type": "count-messages",
            "version": "1.0.0",
            "author": "parasaurolophus <apps@rader.us>",
            "desc": "Count the number of MQTT messages received on a specfied topic",
            "keywords": "mqtt",
            "license": "MIT"
        },
        "color": "#DDAA99",
        "outputLabels": [
            "msg",
            "count"
        ],
        "status": {
            "x": 760,
            "y": 260,
            "wires": [
                {
                    "id": "b48a863d01a8dadf",
                    "port": 0
                }
            ]
        }
    },
    {
        "id": "be201d7a24b331c5",
        "type": "subflow",
        "name": "As Time",
        "info": "",
        "category": "waubesa",
        "in": [],
        "out": [
            {
                "x": 440,
                "y": 40,
                "wires": [
                    {
                        "id": "a96e0b1ad753faa2",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [
            {
                "name": "TOPIC",
                "type": "str",
                "value": ""
            }
        ],
        "meta": {
            "module": "@parasaurolophus/node-red-as-time",
            "type": "as-time",
            "version": "1.0.0",
            "author": "parasaurolophus <apps@rader.us>",
            "desc": "Format the payload as a local time string",
            "keywords": "utility,automation",
            "license": "MIT"
        },
        "color": "#DDAA99",
        "status": {
            "x": 620,
            "y": 120,
            "wires": [
                {
                    "id": "644bea96363a82cd",
                    "port": 0
                }
            ]
        }
    },
    {
        "id": "bdefba026bd44159",
        "type": "subflow",
        "name": "Get All PowerView Metadata",
        "info": "",
        "category": "powerview",
        "in": [
            {
                "x": 40,
                "y": 300,
                "wires": [
                    {
                        "id": "e3ada32cfe945566"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1240,
                "y": 140,
                "wires": [
                    {
                        "id": "aaa91f5ba0fc0079",
                        "port": 0
                    }
                ]
            },
            {
                "x": 1230,
                "y": 320,
                "wires": [
                    {
                        "id": "1528c95d1ce354b7",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [
            {
                "name": "ADDRESS",
                "type": "str",
                "value": ""
            }
        ],
        "meta": {
            "module": "@parasaurolophus/node-red-get-all-powerview-metadata",
            "type": "get-all-powerview-metadata",
            "version": "1.0.0",
            "author": "parasaurolophus <apps@rader.us>",
            "desc": "Get the metadata from a PowerView hub to drive dynamic dashboard controls",
            "keywords": "hunter-douglas,powerview",
            "license": "MIT"
        },
        "color": "#C0DEED",
        "outputLabels": [
            "metadata",
            "error"
        ],
        "icon": "font-awesome/fa-align-justify",
        "status": {
            "x": 1200,
            "y": 60,
            "wires": [
                {
                    "id": "a202428337525b92",
                    "port": 0
                }
            ]
        }
    },
    {
        "id": "da7c0eae8eb34f5a",
        "type": "subflow",
        "name": "Get Hue Resources",
        "info": "",
        "category": "hue",
        "in": [
            {
                "x": 60,
                "y": 80,
                "wires": [
                    {
                        "id": "73158386ef7595ee"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1160,
                "y": 60,
                "wires": [
                    {
                        "id": "95d13bf160785919",
                        "port": 0
                    }
                ]
            },
            {
                "x": 930,
                "y": 120,
                "wires": [
                    {
                        "id": "eda70ffbfd0bef99",
                        "port": 1
                    }
                ]
            }
        ],
        "env": [
            {
                "name": "ADDRESS",
                "type": "str",
                "value": ""
            },
            {
                "name": "KEY",
                "type": "str",
                "value": ""
            },
            {
                "name": "TOPIC",
                "type": "str",
                "value": ""
            }
        ],
        "meta": {},
        "color": "#AA77AA",
        "outputLabels": [
            "response",
            "error"
        ],
        "icon": "font-awesome/fa-lightbulb-o",
        "status": {
            "x": 900,
            "y": 240,
            "wires": [
                {
                    "id": "a36b46748c99d4a6",
                    "port": 0
                }
            ]
        }
    },
    {
        "id": "7b61502c01a97f85",
        "type": "subflow",
        "name": "Notify HTTP Error",
        "info": "",
        "category": "waubesa",
        "in": [
            {
                "x": 60,
                "y": 100,
                "wires": [
                    {
                        "id": "d2492fc09315bfc0"
                    },
                    {
                        "id": "30e1991ea828ba4f"
                    }
                ]
            }
        ],
        "out": [],
        "env": [],
        "meta": {},
        "color": "#3FADB5"
    },
    {
        "id": "882c6d268bfa1aec",
        "type": "subflow",
        "name": "Hue Dashboard Controls",
        "info": "",
        "category": "hue",
        "in": [],
        "out": [
            {
                "x": 680,
                "y": 120,
                "wires": [
                    {
                        "id": "d9ae737367ebed62",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [
            {
                "name": "TOPIC",
                "type": "str",
                "value": ""
            }
        ],
        "meta": {},
        "color": "#AA77AA",
        "icon": "font-awesome/fa-lightbulb-o",
        "status": {
            "x": 680,
            "y": 240,
            "wires": [
                {
                    "id": "b10710b8c58d5e66",
                    "port": 0
                }
            ]
        }
    },
    {
        "id": "87285e6bf01cff03",
        "type": "group",
        "z": "1cf0490e7de2f93d",
        "name": "Activate PowerView scene",
        "style": {
            "stroke": "none",
            "fill": "#000000",
            "fill-opacity": "0.1",
            "label": true,
            "color": "#000000"
        },
        "nodes": [
            "2f6cc09457939ce2",
            "7173aa38c9fa93dc",
            "63300052daf495e4"
        ],
        "x": 14,
        "y": 159
    },
    {
        "id": "98cf3b8910bc4f22",
        "type": "group",
        "z": "cbd68ba9caa96a3d",
        "name": "Trigger automation on receipt of mqtt events",
        "style": {
            "stroke": "none",
            "fill": "#000000",
            "fill-opacity": "0.1",
            "label": true,
            "color": "#000000"
        },
        "nodes": [
            "485df563c6545698",
            "1b5ab2bf7ea37b3b",
            "1e6ace60764fec35",
            "784c9929fe789981",
            "6272a0d1ddf8807b",
            "2a94995efda1937e",
            "6b40e38fa169c721",
            "00b200c8b96373d9",
            "56ed153e71b59e89",
            "a9ea7694289d75de",
            "a01e15ec8fb87e05",
            "df682692b16a598e",
            "17fde856a49a6028",
            "8686957868613221"
        ],
        "x": 14,
        "y": 219
    },
    {
        "id": "8a031cfeade40a06",
        "type": "group",
        "z": "cbd68ba9caa96a3d",
        "name": "Fire timer events",
        "style": {
            "stroke": "none",
            "fill": "#000000",
            "fill-opacity": "0.1",
            "label": true,
            "color": "#000000"
        },
        "nodes": [
            "b2c19560f9da088a",
            "a0c7d328b5287989",
            "8c6c3c20f5958599",
            "a0b61336a93a4089",
            "c9d02aeed7d0407f",
            "d534f07cf7c1eb0b",
            "b709b48ce2961f8e",
            "47875e1be48bbf82",
            "4b2e5cdaca43a71b",
            "dcae4a0dbbe2575e"
        ],
        "x": 14,
        "y": 19
    },
    {
        "id": "b438e0cbd64ef6ce",
        "type": "group",
        "z": "b12fd38c090c51f2",
        "name": "Display a chart of daytime sun positions on a given date",
        "style": {
            "stroke": "none",
            "fill": "#000000",
            "fill-opacity": "0.1",
            "label": true,
            "color": "#000000"
        },
        "nodes": [
            "c27168b168847790",
            "3a39c550369bac31",
            "15ce56cf1449ce52",
            "f33b94d2cc59c348",
            "f72b11239792afcf",
            "4dd293c16815dce3",
            "8fe5e01fe99f5026",
            "e7bc056a5ca25bc5",
            "f9a4b2c24da44638",
            "eb296b561972b772"
        ],
        "x": 14,
        "y": 119
    },
    {
        "id": "8a81267cb12384d5",
        "type": "group",
        "z": "b12fd38c090c51f2",
        "name": "Monitor timer events",
        "style": {
            "label": true,
            "color": "#000000",
            "stroke": "none",
            "fill": "#000000",
            "fill-opacity": "0.1"
        },
        "nodes": [
            "3ffae20118b3f324",
            "056b4e63ec2cd405",
            "64f954fed4bbe73e",
            "4332d4706a43e2f6",
            "9e522923ebcadd47",
            "cd359e0f643d8b52",
            "6ce0fae7a630111f",
            "6fd30861ee594f7a",
            "7b3880a941748a69",
            "a6c27a31c49422e4",
            "03b32d05f0dc98c7",
            "3a0d9afd6a91a4b8",
            "119dc5e83c2a078f",
            "b403745b92a95d79",
            "c6ad3ce00565e461",
            "fb5206dc8bb107e5",
            "61c5be84a6996eee",
            "a921a5a41ab154fc"
        ],
        "x": 14,
        "y": 299
    },
    {
        "id": "70e9b8db12799d18",
        "type": "group",
        "z": "c7141ffb22d64190",
        "name": "Send requests to the ground floor Hue bridge",
        "style": {
            "stroke": "none",
            "fill": "#000000",
            "fill-opacity": "0.1",
            "label": true,
            "color": "#000000"
        },
        "nodes": [
            "7df3e5fbd6e9aa8a",
            "3b5ab296575b53d4",
            "44f0fb819452b7aa"
        ],
        "x": 14,
        "y": 399,
        "w": 492,
        "h": 82
    },
    {
        "id": "290b83ef8e01ae0f",
        "type": "group",
        "z": "c7141ffb22d64190",
        "name": "Use within 30 seconds of pressing link button on the Hue bridge",
        "style": {
            "fill-opacity": "0.11",
            "label": true,
            "color": "#000000",
            "stroke": "none",
            "fill": "#000000"
        },
        "nodes": [
            "51bce99c75aa12c6",
            "f3ab10cd192709b0",
            "73a1ec5ed8ebc167",
            "edd68fdd0863619a"
        ],
        "x": 14,
        "y": 19,
        "w": 732,
        "h": 122
    },
    {
        "id": "b48f76e13fc77aa7",
        "type": "group",
        "z": "1cf0490e7de2f93d",
        "name": "Dynamically create dashboard controls for window shades based on metadata obtained from PowerView hub",
        "style": {
            "stroke": "none",
            "fill": "#000000",
            "fill-opacity": "0.1",
            "label": true,
            "color": "#000000"
        },
        "nodes": [
            "85c26fe91dc71759",
            "75bff418d99b8d56",
            "7026f2de142e8ef2",
            "942f0a1ef3d8ade3",
            "85e6e4e1fe740e1b",
            "96e7a29d96084487"
        ],
        "x": 14,
        "y": 19
    },
    {
        "id": "431ae4bdb7346af5",
        "type": "group",
        "z": "c7141ffb22d64190",
        "name": "Dynamically create dashboard controls for lighting based on metadata obtained from a Hue bridge",
        "style": {
            "stroke": "none",
            "fill": "#000000",
            "fill-opacity": "0.1",
            "label": true,
            "color": "#000000"
        },
        "nodes": [
            "7def18ac26259af3",
            "abb71db57910be2f",
            "1ed4e6f41dea92e2",
            "e78baddb570f92fa",
            "22a8b1377a9c1022"
        ],
        "x": 14,
        "y": 159,
        "w": 872,
        "h": 122
    },
    {
        "id": "4b0f721c48fca435",
        "type": "group",
        "z": "b12fd38c090c51f2",
        "name": "sun-positions CSV service",
        "style": {
            "stroke": "none",
            "fill": "#000000",
            "fill-opacity": "0.1",
            "label": true,
            "color": "#000000"
        },
        "nodes": [
            "8b169767a6b4cbd9",
            "dbca9a86d3bcf1ec",
            "f33c29023f26968a",
            "8d0db05f4d495979",
            "ba54b4d206406127",
            "b1ebe60c0c09e6c1"
        ],
        "x": 14,
        "y": 19
    },
    {
        "id": "b0f5ce3a323b7dd7",
        "type": "group",
        "z": "c7141ffb22d64190",
        "name": "Subscribe to server-sent events",
        "style": {
            "stroke": "none",
            "fill": "#000000",
            "fill-opacity": "0.1",
            "label": true,
            "color": "#000000"
        },
        "nodes": [
            "7d283a2fc0d30093",
            "54bbaac5bafb7512"
        ],
        "x": 14,
        "y": 499,
        "w": 242,
        "h": 82
    },
    {
        "id": "78e09083a861e13e",
        "type": "group",
        "z": "ff0141ba0f0c7234",
        "name": "Window shade automation",
        "style": {
            "stroke": "none",
            "fill": "#000000",
            "fill-opacity": "0.1",
            "label": true,
            "color": "#000000"
        },
        "nodes": [
            "65ab6145dd1c2e19",
            "b13e36ae61e678c5",
            "92c2876f08baadd9",
            "55f89a635c93f337",
            "5638c682e2ac2fba",
            "5a10fc701135b50d",
            "ea959d418216fe68",
            "6d664c1fce229c1e"
        ],
        "x": 894,
        "y": 319,
        "w": 352,
        "h": 282
    },
    {
        "id": "053656a9e6f3379c",
        "type": "group",
        "z": "ff0141ba0f0c7234",
        "name": "Lighting automation",
        "style": {
            "stroke": "none",
            "fill": "#000000",
            "fill-opacity": "0.1",
            "label": true,
            "color": "#000000"
        },
        "nodes": [
            "59e320abec722230",
            "52a74204d47efd1e",
            "9b05a84bf2e36872",
            "6051debe54e3825e",
            "13ec2fe1e16094a1",
            "84118b9049ec3439",
            "4bb92f343cc9a859",
            "34385092a355cd47",
            "06e95c81925fd3c3",
            "8a9ced356d9b863b",
            "ded409ca4a47d4fa",
            "6957440564321846"
        ],
        "x": 134,
        "y": 259,
        "w": 522,
        "h": 362
    },
    {
        "id": "276fb48c5a5f5cf0",
        "type": "group",
        "z": "ff0141ba0f0c7234",
        "name": "Limit rate at which messages are sent to the MQTT broker",
        "style": {
            "stroke": "none",
            "fill": "#000000",
            "fill-opacity": "0.1",
            "label": true,
            "color": "#000000"
        },
        "nodes": [
            "74f456c57bd0405f",
            "3db511b8fbb93369",
            "efbd1b79e54e0bf7",
            "d935f691d63e1e77",
            "ec3b19f7f91f026d",
            "1a9f2ae66bc3b97b",
            "c985b6125c7dee4a",
            "3a71b6d844f7acb7",
            "4f8791884f618315",
            "af1881c6e1166196"
        ],
        "x": 134,
        "y": 19,
        "w": 652,
        "h": 222
    },
    {
        "id": "1654aea0ccd3a289",
        "type": "group",
        "z": "b12fd38c090c51f2",
        "name": "Monitor Basement Hue readyState",
        "style": {
            "stroke": "none",
            "fill": "#000000",
            "fill-opacity": "0.1",
            "label": true,
            "color": "#000000"
        },
        "nodes": [
            "02ea0683c75f69c5",
            "70078a31791fbbc5",
            "b419f6a87901aa7d",
            "c87b61478949025d"
        ],
        "x": 674,
        "y": 519
    },
    {
        "id": "7a60f981743e0c00",
        "type": "group",
        "z": "b12fd38c090c51f2",
        "name": "Monitor ground floor Hue readyState",
        "style": {
            "stroke": "none",
            "fill": "#000000",
            "fill-opacity": "0.1",
            "label": true,
            "color": "#000000"
        },
        "nodes": [
            "f824597938fe8446",
            "362e8e438951f6f5",
            "b016ab17f51ffdc7",
            "ed8b62a9f546bb94"
        ],
        "x": 14,
        "y": 519
    },
    {
        "id": "cde8d276df445e2f",
        "type": "group",
        "z": "810a8b527afd2b1b",
        "name": "Send requests to the basement Hue bridge",
        "style": {
            "stroke": "none",
            "fill": "#000000",
            "fill-opacity": "0.1",
            "label": true,
            "color": "#000000"
        },
        "nodes": [
            "64274eb0d8b9e5dd",
            "33b523d447c86f23",
            "a2c690258588b4d5"
        ],
        "x": 14,
        "y": 399,
        "w": 492,
        "h": 82
    },
    {
        "id": "e7188f251e14aea1",
        "type": "group",
        "z": "810a8b527afd2b1b",
        "name": "Use within 30 seconds of pressing link button on the Hue bridge",
        "style": {
            "fill-opacity": "0.1",
            "label": true,
            "color": "#000000",
            "stroke": "none",
            "fill": "#000000"
        },
        "nodes": [
            "608e6356fbb9f384",
            "26973bac8c6a9dba",
            "a12bdbda86868f06",
            "bddbce9f11c0ea01"
        ],
        "x": 14,
        "y": 19,
        "w": 752,
        "h": 122
    },
    {
        "id": "4e52881346c9e44b",
        "type": "group",
        "z": "810a8b527afd2b1b",
        "name": "Cache metadata for a Hue bridge at start",
        "style": {
            "stroke": "none",
            "fill": "#000000",
            "fill-opacity": "0.1",
            "label": true,
            "color": "#000000"
        },
        "nodes": [
            "678145510dc4c76f",
            "d638e45951bb8819",
            "eba8e1c8260d9915",
            "ab63a9de566fc346",
            "01dabb1829a3e85e"
        ],
        "x": 14,
        "y": 159,
        "w": 872,
        "h": 122
    },
    {
        "id": "599f55425211e232",
        "type": "group",
        "z": "810a8b527afd2b1b",
        "name": "Subscribe to server-sent events",
        "style": {
            "stroke": "none",
            "fill": "#000000",
            "fill-opacity": "0.1",
            "label": true,
            "color": "#000000"
        },
        "nodes": [
            "7dcd1d246a096330",
            "968fd6d85ac60a62"
        ],
        "x": 14,
        "y": 499,
        "w": 242,
        "h": 82
    },
    {
        "id": "f8dce80b21d7f706",
        "type": "group",
        "z": "c7141ffb22d64190",
        "name": "Yard",
        "style": {
            "stroke": "none",
            "stroke-opacity": "0.1",
            "label": true,
            "color": "#000000",
            "fill": "#000000",
            "fill-opacity": "0.1"
        },
        "nodes": [
            "2bb38044a932fa69",
            "64a68d2a2d2e93cd",
            "b11c745f6ce17117",
            "7e843abc77537f92",
            "510f4653645e17d0",
            "67013f62ca5bcb43",
            "feaf54e6c16337c1",
            "d92030613c5ce50e",
            "cb0bc87b9e465a2f",
            "da79b96d161e1c28",
            "5539f5e5fa8f4bb2"
        ],
        "x": 934,
        "y": 339,
        "w": 362,
        "h": 242
    },
    {
        "id": "f848d645bd1abc5b",
        "type": "group",
        "z": "c7141ffb22d64190",
        "name": "Main Bathroom",
        "style": {
            "stroke": "none",
            "stroke-opacity": "0.1",
            "label": true,
            "color": "#000000",
            "fill": "#000000",
            "fill-opacity": "0.1"
        },
        "nodes": [
            "df41f3a116d28de2",
            "a122f1a4fc3399e5",
            "012902774c9657f1",
            "90cec6147a7de28f",
            "b377dfca55193e3b"
        ],
        "x": 1014,
        "y": 199,
        "w": 282,
        "h": 122
    },
    {
        "id": "0770b0ba393f379d",
        "type": "group",
        "z": "1cf0490e7de2f93d",
        "name": "Control shades",
        "style": {
            "stroke": "none",
            "fill": "#000000",
            "fill-opacity": "0.1",
            "label": true,
            "color": "#000000"
        },
        "nodes": [
            "71f42f61777d49d9",
            "16c6de044f949382",
            "4d9c62d6c2145813",
            "4f656e2b5766e68f",
            "cab89ebfeca22623",
            "a0e918936b64e067",
            "3fa2af1c1f32f8ee",
            "1fcfbbdf6167f8c8",
            "dcd2a91c5972ccf0"
        ],
        "x": 114,
        "y": 259
    },
    {
        "id": "b1ee6e019c90396d",
        "type": "group",
        "z": "c7141ffb22d64190",
        "name": "Main Floor",
        "style": {
            "stroke": "none",
            "fill": "#000000",
            "fill-opacity": "0.1",
            "label": true,
            "color": "#000000"
        },
        "nodes": [
            "52f0cba3f9b87632",
            "72acc2a8bcbc1528",
            "0acba8178934baa1",
            "1c5888bd24d0a311",
            "fe5fdd858e8b907d",
            "64afce8ff0b75f48",
            "5453ecd10d2275d7"
        ],
        "x": 1014,
        "y": 19,
        "w": 302,
        "h": 162
    },
    {
        "id": "74df0c542b5a3bbd",
        "type": "group",
        "z": "810a8b527afd2b1b",
        "name": "Dynamically create dashboard controls for a Hue bridge",
        "style": {
            "stroke": "none",
            "fill": "#000000",
            "fill-opacity": "0.1",
            "label": true,
            "color": "#000000"
        },
        "nodes": [
            "40ce873d4a67d8f4",
            "6d75fc9fc3d3a168",
            "c31b3f586efc5c75"
        ],
        "x": 14,
        "y": 299,
        "w": 562,
        "h": 82
    },
    {
        "id": "d4fbb88ed29d4d7f",
        "type": "group",
        "z": "c7141ffb22d64190",
        "name": "Dynamically create dashboard controls for a Hue bridge",
        "style": {
            "stroke": "none",
            "fill": "#000000",
            "fill-opacity": "0.1",
            "label": true,
            "color": "#000000"
        },
        "nodes": [
            "c11e7d50f626ad85",
            "f4e7f3f6609ec608",
            "b91aabd7ec998121"
        ],
        "x": 14,
        "y": 299,
        "w": 582,
        "h": 82
    },
    {
        "id": "ded409ca4a47d4fa",
        "type": "junction",
        "z": "ff0141ba0f0c7234",
        "g": "053656a9e6f3379c",
        "x": 360,
        "y": 460,
        "wires": [
            [
                "8a9ced356d9b863b",
                "6957440564321846"
            ]
        ]
    },
    {
        "id": "92bf347e01bdb9bd",
        "type": "junction",
        "z": "de620fed3bdb7aa9",
        "x": 1160,
        "y": 300,
        "wires": [
            [
                "10539047c783b994"
            ]
        ]
    },
    {
        "id": "07b7cd7585d17a91",
        "type": "junction",
        "z": "de620fed3bdb7aa9",
        "x": 1140,
        "y": 160,
        "wires": [
            [
                "0d59cdef0e0a6e85"
            ]
        ]
    },
    {
        "id": "4490a15746b1ed6b",
        "type": "junction",
        "z": "de620fed3bdb7aa9",
        "x": 1140,
        "y": 80,
        "wires": [
            [
                "0d59cdef0e0a6e85"
            ]
        ]
    },
    {
        "id": "7bea9f8574989988",
        "type": "junction",
        "z": "4e89e7c952d56c09",
        "x": 640,
        "y": 220,
        "wires": [
            [
                "1bf87f4377d87af1"
            ]
        ]
    },
    {
        "id": "e79e0110c2317edb",
        "type": "tls-config",
        "name": "",
        "cert": "",
        "key": "",
        "ca": "",
        "certname": "",
        "keyname": "",
        "caname": "",
        "servername": "",
        "verifyservercert": false,
        "alpnprotocol": ""
    },
    {
        "id": "63c00f105cc3255f",
        "type": "ui_base",
        "theme": {
            "name": "theme-dark",
            "lightTheme": {
                "default": "#0094CE",
                "baseColor": "#0094CE",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "edited": true,
                "reset": false
            },
            "darkTheme": {
                "default": "#097479",
                "baseColor": "#9929bd",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "edited": true,
                "reset": false
            },
            "customTheme": {
                "name": "Untitled Theme 1",
                "default": "#4B7930",
                "baseColor": "#4B7930",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"
            },
            "themeState": {
                "base-color": {
                    "default": "#097479",
                    "value": "#9929bd",
                    "edited": true
                },
                "page-titlebar-backgroundColor": {
                    "value": "#9929bd",
                    "edited": false
                },
                "page-backgroundColor": {
                    "value": "#111111",
                    "edited": false
                },
                "page-sidebar-backgroundColor": {
                    "value": "#333333",
                    "edited": false
                },
                "group-textColor": {
                    "value": "#bb58db",
                    "edited": false
                },
                "group-borderColor": {
                    "value": "#555555",
                    "edited": false
                },
                "group-backgroundColor": {
                    "value": "#333333",
                    "edited": false
                },
                "widget-textColor": {
                    "value": "#eeeeee",
                    "edited": false
                },
                "widget-backgroundColor": {
                    "value": "#9929bd",
                    "edited": false
                },
                "widget-borderColor": {
                    "value": "#333333",
                    "edited": false
                },
                "base-font": {
                    "value": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"
                }
            },
            "angularTheme": {
                "primary": "indigo",
                "accents": "blue",
                "warn": "red",
                "background": "grey",
                "palette": "light"
            }
        },
        "site": {
            "name": "Waubesa",
            "hideToolbar": "false",
            "allowSwipe": "true",
            "lockMenu": "false",
            "allowTempTheme": "true",
            "dateFormat": "MM/DD/YYYY",
            "sizes": {
                "sx": 48,
                "sy": 48,
                "gx": 6,
                "gy": 6,
                "cx": 6,
                "cy": 6,
                "px": 0,
                "py": 0
            }
        }
    },
    {
        "id": "722d62f3b93039c3",
        "type": "mqtt-broker",
        "name": "",
        "broker": "broker.local",
        "port": "1883",
        "clientid": "",
        "autoConnect": true,
        "usetls": false,
        "protocolVersion": "4",
        "keepalive": "60",
        "cleansession": true,
        "birthTopic": "",
        "birthQos": "0",
        "birthRetain": "false",
        "birthPayload": "",
        "birthMsg": {},
        "closeTopic": "",
        "closeQos": "0",
        "closeRetain": "false",
        "closePayload": "",
        "closeMsg": {},
        "willTopic": "",
        "willQos": "0",
        "willRetain": "false",
        "willPayload": "",
        "willMsg": {},
        "sessionExpiry": ""
    },
    {
        "id": "ec4d94df679f3b11",
        "type": "ui_tab",
        "name": "Automation",
        "icon": "fa-clock-o",
        "order": 4,
        "disabled": false,
        "hidden": false
    },
    {
        "id": "25c7f0078ed443dd",
        "type": "ui_group",
        "name": "Time",
        "tab": "ec4d94df679f3b11",
        "order": 1,
        "disp": true,
        "width": "6",
        "collapse": true,
        "className": ""
    },
    {
        "id": "03b0e40844d33477",
        "type": "ui_group",
        "name": "Ground Floor Hue",
        "tab": "ec4d94df679f3b11",
        "order": 4,
        "disp": true,
        "width": "6",
        "collapse": true,
        "className": ""
    },
    {
        "id": "a0da6d89d75fc6ac",
        "type": "ui_group",
        "name": "Basement Hue",
        "tab": "ec4d94df679f3b11",
        "order": 5,
        "disp": true,
        "width": "6",
        "collapse": true,
        "className": ""
    },
    {
        "id": "8055574ccb17e8ed",
        "type": "ui_group",
        "name": "Sun Position",
        "tab": "ec4d94df679f3b11",
        "order": 2,
        "disp": true,
        "width": "6",
        "collapse": true,
        "className": ""
    },
    {
        "id": "791bf5d34d06adaf",
        "type": "ui_tab",
        "name": "Controls",
        "icon": "fa-home",
        "order": 2,
        "disabled": false,
        "hidden": false
    },
    {
        "id": "21f11f110d626f5a",
        "type": "ui_group",
        "name": "Ground Floor Lighting",
        "tab": "791bf5d34d06adaf",
        "order": 1,
        "disp": true,
        "width": "6",
        "collapse": true,
        "className": ""
    },
    {
        "id": "e3fcd4654cf9f3fc",
        "type": "ui_group",
        "name": "Window Shades",
        "tab": "791bf5d34d06adaf",
        "order": 3,
        "disp": true,
        "width": "6",
        "collapse": true,
        "className": ""
    },
    {
        "id": "178c0c0ade9cbfc5",
        "type": "ui_group",
        "name": "Basement Lighting",
        "tab": "791bf5d34d06adaf",
        "order": 2,
        "disp": true,
        "width": "6",
        "collapse": true,
        "className": ""
    },
    {
        "id": "d198490f207c2a62",
        "type": "ui_group",
        "name": "MQTT Broker",
        "tab": "ec4d94df679f3b11",
        "order": 3,
        "disp": true,
        "width": "6",
        "collapse": true,
        "className": ""
    },
    {
        "id": "c9c806d81ab63ac4",
        "type": "delay",
        "z": "5785c8d9f39df67e",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 350,
        "y": 60,
        "wires": [
            [
                "20ac42d7649c260a"
            ]
        ]
    },
    {
        "id": "fa870f94fa1ea10b",
        "type": "change",
        "z": "5785c8d9f39df67e",
        "name": "url and headers",
        "rules": [
            {
                "t": "set",
                "p": "headers",
                "pt": "msg",
                "to": "{\"hue-application-key\": $env('KEY')}",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "url",
                "pt": "msg",
                "to": "'https://' & $env('ADDRESS') & '/clip/v2/' & topic",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 180,
        "y": 60,
        "wires": [
            [
                "c9c806d81ab63ac4"
            ]
        ]
    },
    {
        "id": "20ac42d7649c260a",
        "type": "http request",
        "z": "5785c8d9f39df67e",
        "name": "",
        "method": "use",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "",
        "tls": "e79e0110c2317edb",
        "persist": false,
        "proxy": "",
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 510,
        "y": 60,
        "wires": [
            [
                "c029fcaa62306eb2"
            ]
        ]
    },
    {
        "id": "1e35b6e766e6b3d1",
        "type": "status",
        "z": "5785c8d9f39df67e",
        "name": "",
        "scope": [
            "c9c806d81ab63ac4"
        ],
        "x": 720,
        "y": 140,
        "wires": [
            []
        ]
    },
    {
        "id": "c029fcaa62306eb2",
        "type": "function",
        "z": "5785c8d9f39df67e",
        "name": "validate response",
        "func": "if (((typeof msg.statusCode) != 'number') || (msg.statusCode < 200) || (msg.statusCode > 299)) {\n\n    return msg\n\n}\n\nif (!msg.payload.errors || (msg.payload.errors.length > 0)) {\n\n    return msg\n\n}\n\nreturn null",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 690,
        "y": 60,
        "wires": [
            []
        ],
        "outputLabels": [
            "response"
        ]
    },
    {
        "id": "e4718ecfdb248cc7",
        "type": "http request",
        "z": "75bc72a16c4da2c8",
        "name": "",
        "method": "POST",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "",
        "tls": "e79e0110c2317edb",
        "persist": false,
        "proxy": "",
        "authType": "",
        "senderr": false,
        "x": 310,
        "y": 40,
        "wires": [
            []
        ]
    },
    {
        "id": "7316ae1eef4c6295",
        "type": "change",
        "z": "75bc72a16c4da2c8",
        "name": "request key",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"devicetype\":$env('USERNAME'),\"generateclientkey\":true}",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "url",
                "pt": "msg",
                "to": "'https://' & $env('ADDRESS') & '/api'",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 150,
        "y": 40,
        "wires": [
            [
                "e4718ecfdb248cc7"
            ]
        ]
    },
    {
        "id": "64ad1b43047cb836",
        "type": "status",
        "z": "75bc72a16c4da2c8",
        "name": "",
        "scope": [
            "e4718ecfdb248cc7"
        ],
        "x": 320,
        "y": 100,
        "wires": [
            []
        ]
    },
    {
        "id": "cd442f62fd059172",
        "type": "change",
        "z": "9c4e4702e4660adf",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "url",
                "pt": "msg",
                "to": "'http://' & $env('ADDRESS') & '/api/scenes?sceneId=' & payload",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 330,
        "y": 60,
        "wires": [
            [
                "8dc3bcf508fc6c98"
            ]
        ]
    },
    {
        "id": "8dc3bcf508fc6c98",
        "type": "http request",
        "z": "9c4e4702e4660adf",
        "name": "",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "senderr": false,
        "x": 490,
        "y": 60,
        "wires": [
            [
                "9537c5c46c84bb18"
            ]
        ]
    },
    {
        "id": "728ab503eb1eb941",
        "type": "status",
        "z": "9c4e4702e4660adf",
        "name": "",
        "scope": [
            "dcd553804e687131"
        ],
        "x": 660,
        "y": 140,
        "wires": [
            []
        ]
    },
    {
        "id": "dcd553804e687131",
        "type": "delay",
        "z": "9c4e4702e4660adf",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 170,
        "y": 60,
        "wires": [
            [
                "cd442f62fd059172"
            ]
        ]
    },
    {
        "id": "9537c5c46c84bb18",
        "type": "switch",
        "z": "9c4e4702e4660adf",
        "name": "check status",
        "property": "statusCode",
        "propertyType": "msg",
        "rules": [
            {
                "t": "jsonata_exp",
                "v": "$not($type(statusCode) = 'number') or (statusCode < 200) or (statusCode > 299)",
                "vt": "jsonata"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 1,
        "x": 650,
        "y": 60,
        "wires": [
            []
        ]
    },
    {
        "id": "465f820637e0f695",
        "type": "change",
        "z": "4920eed654c67f8d",
        "name": "request metadata",
        "rules": [
            {
                "t": "set",
                "p": "url",
                "pt": "msg",
                "to": "'http://' & $env('ADDRESS') & '/api/' & topic & '/'",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "method",
                "pt": "msg",
                "to": "GET",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 190,
        "y": 80,
        "wires": [
            [
                "aee06735642ad3d1"
            ]
        ]
    },
    {
        "id": "014121091f945d16",
        "type": "status",
        "z": "4920eed654c67f8d",
        "name": "",
        "scope": null,
        "x": 1020,
        "y": 240,
        "wires": [
            []
        ]
    },
    {
        "id": "5f901048f28c6afa",
        "type": "link out",
        "z": "4920eed654c67f8d",
        "name": "retry",
        "mode": "link",
        "links": [],
        "x": 1115,
        "y": 180,
        "wires": []
    },
    {
        "id": "0d25b700ae988fbe",
        "type": "function",
        "z": "4920eed654c67f8d",
        "name": "check status code",
        "func": "const retry = flow.get('retry')\nconst request = retry[msg._msgid]\n\ndelete retry[msg._msgid]\nflow.set('retry', retry)\n\nif (((typeof msg.statusCode) != 'number') || (msg.statusCode < 200) || (msg.statusCode > 299)) {\n\n    let delay = Number.parseInt(env.get('DELAY')) * 1000\n\n    if (msg.retry && (msg.retry > 0)) {\n\n        delay = msg.retry * 1000\n\n    }\n\n    const adjustment = Math.floor(Math.random() * delay)\n\n    request.delay = Math.floor(delay / 2) + adjustment\n    return [null, msg, request]\n\n}\n\nreturn [msg, null, null]",
        "outputs": 3,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 950,
        "y": 120,
        "wires": [
            [],
            [],
            [
                "5f901048f28c6afa"
            ]
        ],
        "outputLabels": [
            "response",
            "error",
            "retry"
        ]
    },
    {
        "id": "74eb45dc0506e2f8",
        "type": "http request",
        "z": "4920eed654c67f8d",
        "name": "",
        "method": "use",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 770,
        "y": 120,
        "wires": [
            [
                "0d25b700ae988fbe"
            ]
        ]
    },
    {
        "id": "9ba5e5cf42e949b8",
        "type": "delay",
        "z": "4920eed654c67f8d",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 610,
        "y": 120,
        "wires": [
            [
                "74eb45dc0506e2f8"
            ]
        ]
    },
    {
        "id": "aee06735642ad3d1",
        "type": "function",
        "z": "4920eed654c67f8d",
        "name": "save request for retry",
        "func": "const retry = flow.get('retry') || {}\n\nretry[msg._msgid] = RED.util.cloneMessage(msg)\nflow.set('retry', retry)\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 420,
        "y": 120,
        "wires": [
            [
                "9ba5e5cf42e949b8"
            ]
        ]
    },
    {
        "id": "c8a4676d82ebdd39",
        "type": "trigger",
        "z": "4920eed654c67f8d",
        "name": "retry",
        "op1": "",
        "op2": "",
        "op1type": "nul",
        "op2type": "payl",
        "duration": "30",
        "extend": false,
        "overrideDelay": true,
        "units": "s",
        "reset": "",
        "bytopic": "all",
        "topic": "topic",
        "outputs": 1,
        "x": 230,
        "y": 160,
        "wires": [
            [
                "aee06735642ad3d1"
            ]
        ]
    },
    {
        "id": "a0aadf80c36786f9",
        "type": "link in",
        "z": "4920eed654c67f8d",
        "name": "retry",
        "links": [],
        "x": 135,
        "y": 160,
        "wires": [
            [
                "c8a4676d82ebdd39"
            ]
        ]
    },
    {
        "id": "7972bbcf134f786b",
        "type": "function",
        "z": "4e89e7c952d56c09",
        "name": "updateState",
        "func": "const state = flow.get('state') || {}\nconst type = state[msg.payload.type] || {}\nconst resource = type[msg.payload.id] || {}\n\nfor (const attribute in msg.payload) {\n\n    resource[attribute] = msg.payload[attribute]\n\n}\n\ntype[resource.id] = resource\nstate[resource.type] = type\nflow.set('state', state)\nmsg.topic = env.get('TOPIC') + '/' + resource.type + '/' + resource.id\nmsg.qos = 2\nmsg.retain = true\nmsg.payload = resource\n\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1050,
        "y": 60,
        "wires": [
            []
        ]
    },
    {
        "id": "74ccf37d5b5cc460",
        "type": "switch",
        "z": "4e89e7c952d56c09",
        "name": "",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "jsonata_exp",
                "v": "topic = 'add' or topic = 'update'",
                "vt": "jsonata"
            },
            {
                "t": "eq",
                "v": "delete",
                "vt": "str"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 2,
        "x": 890,
        "y": 100,
        "wires": [
            [
                "7972bbcf134f786b"
            ],
            [
                "f3d6eb631a33249c"
            ]
        ]
    },
    {
        "id": "f3d6eb631a33249c",
        "type": "function",
        "z": "4e89e7c952d56c09",
        "name": "deleteState",
        "func": "const state = flow.get('state') || {}\n\nif (Object.prototype.hasOwnProperty.call(state, msg.payload.type)) {\n\n    const type = state[msg.payload.type]\n\n    if (Object.prototype.hasOwnProperty.call(type, msg.payload.id)) {\n\n        delete type[msg.payload.id]\n\n    }\n\n}\n\nflow.set('state', state)\nmsg.topic = env.get('TOPIC') + '/' + msg.payload.type + '/' + msg.payload.id\nmsg.qos = 2\nmsg.retain = true\nmsg.payload = ''\n\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1050,
        "y": 140,
        "wires": [
            []
        ]
    },
    {
        "id": "35fad88b119f8f36",
        "type": "status",
        "z": "4e89e7c952d56c09",
        "name": "",
        "scope": [
            "b3c5813303ac7896"
        ],
        "x": 660,
        "y": 300,
        "wires": [
            [
                "9827fd9dee4289ac"
            ]
        ]
    },
    {
        "id": "b3c5813303ac7896",
        "type": "subflow:de620fed3bdb7aa9",
        "z": "4e89e7c952d56c09",
        "name": "",
        "x": 470,
        "y": 140,
        "wires": [
            [
                "c51e9f68572dcd4f"
            ],
            [
                "7bea9f8574989988"
            ],
            [
                "7bea9f8574989988"
            ]
        ],
        "info": "// nrlint no-overlapping-nodes:off\n"
    },
    {
        "id": "c51e9f68572dcd4f",
        "type": "subflow:4b1f9e8c23fa098d",
        "z": "4e89e7c952d56c09",
        "name": "",
        "x": 730,
        "y": 100,
        "wires": [
            [
                "74ccf37d5b5cc460"
            ]
        ]
    },
    {
        "id": "42539f9217e51fbd",
        "type": "change",
        "z": "4e89e7c952d56c09",
        "name": "hue parameters",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"url\":\"https://\" & $env('ADDRESS') & \"/eventstream/clip/v2\",\"initDict\":{\"withCredentials\":false,\"https\":{\"rejectUnauthorized\":false},\"headers\":{\"hue-application-key\":$env('KEY')}}}",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 280,
        "y": 140,
        "wires": [
            [
                "b3c5813303ac7896"
            ]
        ]
    },
    {
        "id": "1bf87f4377d87af1",
        "type": "change",
        "z": "4e89e7c952d56c09",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "$env('TOPIC') & '/' & topic",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "qos",
                "pt": "msg",
                "to": "2",
                "tot": "num"
            },
            {
                "t": "set",
                "p": "retain",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1040,
        "y": 220,
        "wires": [
            []
        ]
    },
    {
        "id": "9827fd9dee4289ac",
        "type": "change",
        "z": "4e89e7c952d56c09",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "status",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "$number(status.text)",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 840,
        "y": 260,
        "wires": [
            [
                "1bf87f4377d87af1"
            ]
        ]
    },
    {
        "id": "d993f8d356c8b076",
        "type": "inject",
        "z": "4e89e7c952d56c09",
        "name": "at start",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 120,
        "y": 140,
        "wires": [
            [
                "42539f9217e51fbd"
            ]
        ]
    },
    {
        "id": "cdd12e98966ee7c4",
        "type": "EventSource",
        "z": "de620fed3bdb7aa9",
        "name": "",
        "x": 1010,
        "y": 160,
        "wires": [
            [
                "4490a15746b1ed6b"
            ],
            [
                "07b7cd7585d17a91"
            ],
            [
                "92bf347e01bdb9bd"
            ]
        ],
        "info": "// nrlint no-overlapping-nodes:off\n"
    },
    {
        "id": "eef1022d50fc9776",
        "type": "change",
        "z": "de620fed3bdb7aa9",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "parameters",
                "pt": "flow",
                "to": "payload",
                "tot": "msg",
                "dc": true
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 810,
        "y": 120,
        "wires": [
            [
                "cdd12e98966ee7c4"
            ]
        ]
    },
    {
        "id": "d901234fd1fce55c",
        "type": "status",
        "z": "de620fed3bdb7aa9",
        "name": "",
        "scope": [
            "cdd12e98966ee7c4"
        ],
        "x": 80,
        "y": 240,
        "wires": [
            [
                "fabe0aac918a0c99"
            ]
        ]
    },
    {
        "id": "fabe0aac918a0c99",
        "type": "switch",
        "z": "de620fed3bdb7aa9",
        "name": "readyState = 2?",
        "property": "status.text",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "2",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 2,
        "x": 260,
        "y": 200,
        "wires": [
            [
                "48fa5f1a9c9b1ec2"
            ],
            [
                "084266e8becbe572"
            ]
        ]
    },
    {
        "id": "c97d943953f14d84",
        "type": "trigger",
        "z": "de620fed3bdb7aa9",
        "name": "watchdog",
        "op1": "",
        "op2": "",
        "op1type": "nul",
        "op2type": "date",
        "duration": "1",
        "extend": true,
        "overrideDelay": true,
        "units": "min",
        "reset": "",
        "bytopic": "all",
        "topic": "topic",
        "outputs": 1,
        "x": 640,
        "y": 200,
        "wires": [
            [
                "ba3b9c14ec9f5691"
            ]
        ]
    },
    {
        "id": "084266e8becbe572",
        "type": "change",
        "z": "de620fed3bdb7aa9",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "reset",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 460,
        "y": 240,
        "wires": [
            [
                "c97d943953f14d84"
            ]
        ]
    },
    {
        "id": "0d59cdef0e0a6e85",
        "type": "link out",
        "z": "de620fed3bdb7aa9",
        "name": "watchdog",
        "mode": "link",
        "links": [
            "1d6da76cca173646"
        ],
        "x": 1195,
        "y": 120,
        "wires": []
    },
    {
        "id": "1d6da76cca173646",
        "type": "link in",
        "z": "de620fed3bdb7aa9",
        "name": "watchdog",
        "links": [
            "0d59cdef0e0a6e85"
        ],
        "x": 325,
        "y": 120,
        "wires": [
            [
                "48fa5f1a9c9b1ec2"
            ]
        ],
        "info": "// nrlint align-to-grid:off\n"
    },
    {
        "id": "3ba637cbe04def58",
        "type": "link in",
        "z": "de620fed3bdb7aa9",
        "name": "reset",
        "links": [
            "10539047c783b994",
            "df7f3018ef95e2a2"
        ],
        "x": 325,
        "y": 280,
        "wires": [
            [
                "084266e8becbe572"
            ]
        ],
        "info": "// nrlint align-to-grid:off\n"
    },
    {
        "id": "10539047c783b994",
        "type": "link out",
        "z": "de620fed3bdb7aa9",
        "name": "reset",
        "mode": "link",
        "links": [
            "3ba637cbe04def58"
        ],
        "x": 1215,
        "y": 340,
        "wires": []
    },
    {
        "id": "df7f3018ef95e2a2",
        "type": "link out",
        "z": "de620fed3bdb7aa9",
        "name": "reset",
        "mode": "link",
        "links": [
            "3ba637cbe04def58"
        ],
        "x": 735,
        "y": 40,
        "wires": []
    },
    {
        "id": "48fa5f1a9c9b1ec2",
        "type": "change",
        "z": "de620fed3bdb7aa9",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "delay",
                "pt": "msg",
                "to": "TIMEOUT",
                "tot": "env"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 460,
        "y": 160,
        "wires": [
            [
                "c97d943953f14d84"
            ]
        ]
    },
    {
        "id": "ba3b9c14ec9f5691",
        "type": "change",
        "z": "de620fed3bdb7aa9",
        "name": "get flow.parameters",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "parameters",
                "tot": "flow"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 810,
        "y": 200,
        "wires": [
            [
                "cdd12e98966ee7c4"
            ]
        ]
    },
    {
        "id": "11642f950d52a63f",
        "type": "change",
        "z": "4b1f9e8c23fa098d",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.data",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 180,
        "y": 100,
        "wires": [
            [
                "d6816cf71b63c27e"
            ]
        ]
    },
    {
        "id": "d6816cf71b63c27e",
        "type": "json",
        "z": "4b1f9e8c23fa098d",
        "name": "",
        "property": "payload",
        "action": "obj",
        "pretty": false,
        "x": 330,
        "y": 100,
        "wires": [
            [
                "b4da061c0dd45c54"
            ]
        ]
    },
    {
        "id": "b4da061c0dd45c54",
        "type": "split",
        "z": "4b1f9e8c23fa098d",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 450,
        "y": 100,
        "wires": [
            [
                "94e9fe9a9f7af221"
            ]
        ]
    },
    {
        "id": "94e9fe9a9f7af221",
        "type": "change",
        "z": "4b1f9e8c23fa098d",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "payload.type",
                "tot": "msg"
            },
            {
                "t": "move",
                "p": "payload.data",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 600,
        "y": 100,
        "wires": [
            [
                "c4f2d5d0acdf4cc1"
            ]
        ]
    },
    {
        "id": "c4f2d5d0acdf4cc1",
        "type": "split",
        "z": "4b1f9e8c23fa098d",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 750,
        "y": 100,
        "wires": [
            [
                "612b03cff3e03da9"
            ]
        ]
    },
    {
        "id": "612b03cff3e03da9",
        "type": "change",
        "z": "4b1f9e8c23fa098d",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"text\":payload.type,\"shape\":\"ring\",\"fill\":\"blue\"}",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 920,
        "y": 140,
        "wires": [
            []
        ]
    },
    {
        "id": "3889cb8956554e6f",
        "type": "mqtt in",
        "z": "9601cbf2386d897b",
        "name": "",
        "topic": "${TOPIC}",
        "qos": "2",
        "datatype": "json",
        "broker": "722d62f3b93039c3",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 460,
        "y": 100,
        "wires": [
            [
                "29db695f97cc5757"
            ]
        ]
    },
    {
        "id": "29db695f97cc5757",
        "type": "function",
        "z": "9601cbf2386d897b",
        "name": "count",
        "func": "let count = context.get('count') || 0\n\ncount += 1\ncontext.set('count', count)\n\nnode.status({\n    fill: \"blue\",\n    shape: \"dot\",\n    text: count\n})\n\nreturn [\n    msg,\n    { payload: count }\n]",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 590,
        "y": 100,
        "wires": [
            [],
            []
        ],
        "outputLabels": [
            "msg",
            "count"
        ]
    },
    {
        "id": "3f4427884112393c",
        "type": "status",
        "z": "9601cbf2386d897b",
        "name": "count status",
        "scope": [
            "29db695f97cc5757"
        ],
        "x": 150,
        "y": 220,
        "wires": [
            [
                "c2f18976dc0cf414"
            ]
        ]
    },
    {
        "id": "c2f18976dc0cf414",
        "type": "change",
        "z": "9601cbf2386d897b",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "status.text",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "count",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 320,
        "y": 220,
        "wires": [
            [
                "784dad3b4399f439"
            ]
        ]
    },
    {
        "id": "fd9cbbdd03dc328f",
        "type": "status",
        "z": "9601cbf2386d897b",
        "name": "connection status",
        "scope": [
            "3889cb8956554e6f"
        ],
        "x": 140,
        "y": 300,
        "wires": [
            [
                "eb2d985bad141a6c"
            ]
        ]
    },
    {
        "id": "eb2d985bad141a6c",
        "type": "change",
        "z": "9601cbf2386d897b",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "status.text",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "connection",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 320,
        "y": 300,
        "wires": [
            [
                "784dad3b4399f439"
            ]
        ]
    },
    {
        "id": "784dad3b4399f439",
        "type": "join",
        "z": "9601cbf2386d897b",
        "name": "",
        "mode": "custom",
        "build": "object",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": true,
        "timeout": "",
        "count": "2",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 490,
        "y": 260,
        "wires": [
            [
                "b48a863d01a8dadf"
            ]
        ]
    },
    {
        "id": "b48a863d01a8dadf",
        "type": "change",
        "z": "9601cbf2386d897b",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "status",
                "pt": "msg",
                "to": "{\t   \"text\": $substringAfter(payload.connection, 'node-red:common.status.') & ' | ' & payload.count,\t   \"shape\": \"dot\",\t   \"fill\": \"blue\"\t}",
                "tot": "jsonata"
            },
            {
                "t": "delete",
                "p": "payload",
                "pt": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 640,
        "y": 260,
        "wires": [
            []
        ]
    },
    {
        "id": "7f7ef86a4212cda9",
        "type": "mqtt in",
        "z": "be201d7a24b331c5",
        "name": "",
        "topic": "${TOPIC}",
        "qos": "2",
        "datatype": "json",
        "broker": "722d62f3b93039c3",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 160,
        "y": 80,
        "wires": [
            [
                "a96e0b1ad753faa2"
            ]
        ]
    },
    {
        "id": "a96e0b1ad753faa2",
        "type": "function",
        "z": "be201d7a24b331c5",
        "name": "formatTime",
        "func": "const date = new Date(msg.payload)\n\nmsg.payload = date.toLocaleTimeString()\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 310,
        "y": 80,
        "wires": [
            [
                "644bea96363a82cd"
            ]
        ]
    },
    {
        "id": "644bea96363a82cd",
        "type": "change",
        "z": "be201d7a24b331c5",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"text\":payload,\"shape\":\"dot\",\"fill\":\"blue\"}",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 500,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "18b035d175d78813",
        "type": "function",
        "z": "bdefba026bd44159",
        "name": "mergeMetadata",
        "func": "const scenes = msg.payload\n\n/**\n* @param {{ name: string; }} obj1\n* @param {{ name: any; }} obj2\n*/\nfunction nameCompare(obj1, obj2) {\n\n    return obj1.name.localeCompare(obj2.name)\n\n}\n\n/**\n* @param {any} roomId\n*/\nfunction findScenes(roomId) {\n\n    const selected = []\n\n    for (const scene of scenes) {\n\n        if (scene.roomId == roomId) {\n\n            selected.push({\n                id: scene.sceneId,\n                name: scene.sceneName\n            })\n        }\n    }\n\n    return selected.sort(nameCompare)\n\n}\n\n/**\n* @param {{ scenes: any[]; }} room\n*/\nfunction hasScenes(room) {\n\n    return room.scenes.length > 0\n\n}\n\nmsg.payload = msg.rooms.map((/** @type {{ id: any; name: any; }} */ room) => {\n\n    return {\n        id: room.id,\n        name: room.name,\n        scenes: findScenes(room.id)\n    }\n\n}).filter(hasScenes).sort(nameCompare)\n\nflow.set('$parent.metadata', msg.payload)\n\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 940,
        "y": 140,
        "wires": [
            [
                "aaa91f5ba0fc0079"
            ]
        ]
    },
    {
        "id": "9d0fb43b1d0b583f",
        "type": "change",
        "z": "bdefba026bd44159",
        "name": "decode scene names",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "$map(payload.sceneData, function($scene) {\t    {\t        \"sceneName\": $base64decode($scene.name),\t        \"sceneId\": $scene.id,\t        \"roomId\": $scene.roomId\t    }\t})",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1040,
        "y": 220,
        "wires": [
            [
                "18b035d175d78813"
            ]
        ]
    },
    {
        "id": "837774c682b93af9",
        "type": "subflow:4920eed654c67f8d",
        "z": "bdefba026bd44159",
        "name": "Get PowerVIew Scenes",
        "env": [
            {
                "name": "ADDRESS",
                "value": "ADDRESS",
                "type": "env"
            }
        ],
        "x": 790,
        "y": 260,
        "wires": [
            [
                "9d0fb43b1d0b583f"
            ],
            [
                "de86310de8861ac7"
            ]
        ]
    },
    {
        "id": "42529821fe2b55cd",
        "type": "change",
        "z": "bdefba026bd44159",
        "name": "decode room names",
        "rules": [
            {
                "t": "set",
                "p": "rooms",
                "pt": "msg",
                "to": "$map(payload.roomData, function($room) {\t    {\t        \"name\": $base64decode($room.name),\t        \"id\": $room.id\t    }\t})",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "scenes",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 560,
        "y": 260,
        "wires": [
            [
                "837774c682b93af9"
            ]
        ]
    },
    {
        "id": "4a774d5487ebaf6f",
        "type": "subflow:4920eed654c67f8d",
        "z": "bdefba026bd44159",
        "name": "Get PowerVIew Rooms",
        "env": [
            {
                "name": "ADDRESS",
                "value": "ADDRESS",
                "type": "env"
            }
        ],
        "x": 310,
        "y": 300,
        "wires": [
            [
                "42529821fe2b55cd"
            ],
            [
                "76107863e2b9fc56"
            ]
        ]
    },
    {
        "id": "e3ada32cfe945566",
        "type": "change",
        "z": "bdefba026bd44159",
        "name": "rooms:",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "rooms",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 130,
        "y": 300,
        "wires": [
            [
                "4a774d5487ebaf6f"
            ]
        ]
    },
    {
        "id": "aaa91f5ba0fc0079",
        "type": "template",
        "z": "bdefba026bd44159",
        "name": "",
        "field": "template",
        "fieldType": "msg",
        "format": "html",
        "syntax": "plain",
        "template": "<div>\n    <div ng-repeat=\"room in msg.payload\" style=\"text-align:center\">\n        <p>{{room.name}}</p>\n        <md-button style=\"display:inline-block;margin:1px;text-align:center\" ng-repeat=\"scene in room.scenes\"\n            ng-click=\"send({payload: scene.id})\">\n            {{scene.name}}\n        </md-button>\n    </div>\n</div>",
        "output": "str",
        "x": 1100,
        "y": 140,
        "wires": [
            []
        ]
    },
    {
        "id": "a202428337525b92",
        "type": "status",
        "z": "bdefba026bd44159",
        "name": "",
        "scope": null,
        "x": 1100,
        "y": 60,
        "wires": [
            []
        ]
    },
    {
        "id": "76107863e2b9fc56",
        "type": "link out",
        "z": "bdefba026bd44159",
        "name": "error",
        "mode": "link",
        "links": [
            "1528c95d1ce354b7"
        ],
        "x": 475,
        "y": 340,
        "wires": []
    },
    {
        "id": "1528c95d1ce354b7",
        "type": "link in",
        "z": "bdefba026bd44159",
        "name": "error",
        "links": [
            "76107863e2b9fc56",
            "de86310de8861ac7"
        ],
        "x": 1135,
        "y": 320,
        "wires": [
            []
        ]
    },
    {
        "id": "de86310de8861ac7",
        "type": "link out",
        "z": "bdefba026bd44159",
        "name": "error",
        "mode": "link",
        "links": [
            "1528c95d1ce354b7"
        ],
        "x": 955,
        "y": 300,
        "wires": []
    },
    {
        "id": "73158386ef7595ee",
        "type": "change",
        "z": "da7c0eae8eb34f5a",
        "name": "request resources",
        "rules": [
            {
                "t": "set",
                "p": "headers",
                "pt": "msg",
                "to": "{\"hue-application-key\": $env('KEY')}",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "url",
                "pt": "msg",
                "to": "'https://' & $env('ADDRESS') & '/clip/v2/resource'",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "method",
                "pt": "msg",
                "to": "GET",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 210,
        "y": 120,
        "wires": [
            [
                "5c2db9cd5a64030f"
            ]
        ]
    },
    {
        "id": "0f1e5c1f89089142",
        "type": "http request",
        "z": "da7c0eae8eb34f5a",
        "name": "",
        "method": "use",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "",
        "tls": "e79e0110c2317edb",
        "persist": false,
        "proxy": "",
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 550,
        "y": 120,
        "wires": [
            [
                "eda70ffbfd0bef99"
            ]
        ]
    },
    {
        "id": "5c2db9cd5a64030f",
        "type": "delay",
        "z": "da7c0eae8eb34f5a",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 390,
        "y": 120,
        "wires": [
            [
                "0f1e5c1f89089142"
            ]
        ]
    },
    {
        "id": "eda70ffbfd0bef99",
        "type": "function",
        "z": "da7c0eae8eb34f5a",
        "name": "validate response",
        "func": "if (((typeof msg.statusCode) != 'number') || (msg.statusCode < 200) || (msg.statusCode > 299)) {\n\n    const retry = { payload: '' }\n\n    if (msg.retry && (msg.retry > 0)) {\n\n        retry.delay = msg.retry * 1000\n\n    } else {\n\n        retry.delay = (15 + Math.floor(Math.random() * 30)) * 1000\n    }\n\n    return [null, msg, retry]\n\n}\n\nif ((!msg.payload.errors) || (msg.payload.errors.length > 0)) {\n\n    return [null, msg, null]\n\n}\n\nreturn [msg, null, null]",
        "outputs": 3,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 730,
        "y": 120,
        "wires": [
            [
                "95d13bf160785919"
            ],
            [],
            [
                "4998ceee1b6efa92"
            ]
        ],
        "outputLabels": [
            "response",
            "error",
            "retry"
        ]
    },
    {
        "id": "0da22799d1d910ee",
        "type": "link in",
        "z": "da7c0eae8eb34f5a",
        "name": "retry",
        "links": [
            "911f2ab3297099b4"
        ],
        "x": 65,
        "y": 160,
        "wires": [
            [
                "73158386ef7595ee"
            ]
        ],
        "info": "// nrlint align-to-grid:off\n"
    },
    {
        "id": "4998ceee1b6efa92",
        "type": "trigger",
        "z": "da7c0eae8eb34f5a",
        "name": "retry",
        "op1": "",
        "op2": "",
        "op1type": "nul",
        "op2type": "payl",
        "duration": "30",
        "extend": true,
        "overrideDelay": true,
        "units": "s",
        "reset": "",
        "bytopic": "all",
        "topic": "topic",
        "outputs": 1,
        "x": 930,
        "y": 180,
        "wires": [
            [
                "911f2ab3297099b4"
            ]
        ]
    },
    {
        "id": "911f2ab3297099b4",
        "type": "link out",
        "z": "da7c0eae8eb34f5a",
        "name": "retry",
        "mode": "link",
        "links": [
            "0da22799d1d910ee"
        ],
        "x": 1015,
        "y": 180,
        "wires": []
    },
    {
        "id": "a36b46748c99d4a6",
        "type": "status",
        "z": "da7c0eae8eb34f5a",
        "name": "",
        "scope": [
            "5c2db9cd5a64030f"
        ],
        "x": 800,
        "y": 240,
        "wires": [
            []
        ]
    },
    {
        "id": "95d13bf160785919",
        "type": "function",
        "z": "da7c0eae8eb34f5a",
        "name": "parse hue metadata",
        "func": "const topic = env.get('TOPIC')\nconst grouped_light = []\n\nmsg.payload.data.forEach((/** @type {{ type: string; id: string; on: { on: any; }; }} */ resource) => {\n\n    if (resource.type == 'grouped_light') {\n\n        if (Object.prototype.hasOwnProperty.call(resource, 'on')) {\n\n            grouped_light.push({\n                topic: topic + '/grouped_light/' + resource.id,\n                payload: resource,\n                qos: 2,\n                retain: true\n            })\n        }\n    }\n})\n\n/**\n* @param {any} groupId\n* @param {string} key\n* @param {any[]} resources\n*/\nfunction findReferences(groupId, key, resources) {\n\n    const references = []\n\n    resources.forEach(resource => {\n\n        if (resource[key].rid == groupId) {\n\n            references.push(resource)\n\n        }\n    })\n\n    return references\n\n}\n\n/**\n* @param {{ name: string; }} obj1\n* @param {{ name: any; }} obj2\n*/\nfunction nameCompare(obj1, obj2) {\n\n    return obj1.name.localeCompare(obj2.name)\n\n}\n\n/**\n* @param {{ metadata: { name: any; }; type: any; id: any; }} group\n* @param {{ scene?: any; grouped_light?: any; }} resources\n*/\nfunction getGroup(group, resources) {\n\n    const scenes = findReferences(group.id, 'group', resources.scene).map(scene => {\n\n        return {\n            name: scene.metadata.name,\n            id: scene.id\n        }\n    }).sort(nameCompare)\n\n    const grouped_light = findReferences(group.id, 'owner', resources.grouped_light)[0]\n\n    return {\n        name: group.metadata.name,\n        id: group.id,\n        type: group.type,\n        grouped_light: grouped_light.id,\n        scene: scenes\n    }\n}\n\nconst resources = {}\n\nmsg.payload.data.forEach((/** @type {{ type: string | number; }} */ resource) => {\n\n    const type = resources[resource.type] || []\n    type.push(resource)\n    resources[resource.type] = type\n\n})\n\nconst rooms = resources.room || []\nconst zones = resources.zone || []\n\nconst metadata = {\n    room: rooms.map((/** @type {{ metadata: { name: any; }; type: any; id: any; }} */ room) => {\n        return getGroup(room, resources)\n    }).sort(nameCompare),\n    zone: zones.map((/** @type {{ metadata: { name: any; }; type: any; id: any; }} */ zone) => {\n        return getGroup(zone, resources)\n    }).sort(nameCompare)\n}\n\nflow.set('$parent.metadata', metadata)\nreturn [grouped_light]",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 980,
        "y": 60,
        "wires": [
            []
        ],
        "outputLabels": [
            "merged"
        ]
    },
    {
        "id": "448d1e2ff0ff4a74",
        "type": "ui_toast",
        "z": "7b61502c01a97f85",
        "position": "dialog",
        "displayTime": "3",
        "highlight": "",
        "sendall": true,
        "outputs": 1,
        "ok": "OK",
        "cancel": "",
        "raw": true,
        "className": "",
        "topic": "",
        "name": "",
        "x": 450,
        "y": 60,
        "wires": [
            []
        ]
    },
    {
        "id": "30e1991ea828ba4f",
        "type": "debug",
        "z": "7b61502c01a97f85",
        "name": "http error response",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": true,
        "complete": "true",
        "targetType": "full",
        "statusVal": "statusCode",
        "statusType": "msg",
        "x": 210,
        "y": 140,
        "wires": []
    },
    {
        "id": "0985cf211a9510a2",
        "type": "template",
        "z": "7b61502c01a97f85",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "html",
        "syntax": "mustache",
        "template": "<pre>{{payload}}</pre>",
        "output": "str",
        "x": 300,
        "y": 60,
        "wires": [
            [
                "448d1e2ff0ff4a74"
            ]
        ]
    },
    {
        "id": "d2492fc09315bfc0",
        "type": "function",
        "z": "7b61502c01a97f85",
        "name": "format",
        "func": "msg.payload = JSON.stringify(msg, null, ' ')\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 170,
        "y": 60,
        "wires": [
            [
                "0985cf211a9510a2"
            ]
        ]
    },
    {
        "id": "fbd48fd0a48a3c31",
        "type": "mqtt in",
        "z": "882c6d268bfa1aec",
        "name": "",
        "topic": "${TOPIC}",
        "qos": "2",
        "datatype": "utf8",
        "broker": "722d62f3b93039c3",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 120,
        "y": 80,
        "wires": [
            [
                "2396390d67aa9e8d"
            ]
        ]
    },
    {
        "id": "2396390d67aa9e8d",
        "type": "json",
        "z": "882c6d268bfa1aec",
        "name": "",
        "property": "payload",
        "action": "obj",
        "pretty": false,
        "x": 250,
        "y": 80,
        "wires": [
            [
                "3fe9b64e4c386d21"
            ]
        ]
    },
    {
        "id": "bed67e8de684e3ce",
        "type": "catch",
        "z": "882c6d268bfa1aec",
        "name": "",
        "scope": [
            "2396390d67aa9e8d"
        ],
        "uncaught": false,
        "x": 250,
        "y": 160,
        "wires": [
            [
                "3fe9b64e4c386d21"
            ]
        ]
    },
    {
        "id": "3fe9b64e4c386d21",
        "type": "function",
        "z": "882c6d268bfa1aec",
        "name": "format metadata",
        "func": "const state = context.get('state') || {}\n\nif (msg.payload === '') {\n\n    delete state[msg.topic]\n\n} else {\n\n    if (Object.prototype.hasOwnProperty.call(msg.payload, 'on')) {\n\n        state[msg.topic] = msg.payload\n\n    }\n}\n\ncontext.set('state', state)\n\nconst model = []\nconst metadata = flow.get('$parent.metadata') || {}\n\n/**\n* @param {{ owner: { rid: any; }; id: string; }} grouped_light\n* @param {any} type\n*/\nfunction findGroup(grouped_light, type) {\n\n    for (const group of type) {\n\n        if (group.id == grouped_light.owner.rid) {\n\n            return group\n\n        }\n    }\n\n    throw 'no group found for grouped_light ' + grouped_light.id\n\n}\n\nfor (const topic in state) {\n\n    const grouped_light = state[topic]\n\n    if (!Object.prototype.hasOwnProperty.call(metadata, grouped_light.owner.rtype)) {\n\n        continue\n\n    }\n\n    const group = findGroup(grouped_light, metadata[grouped_light.owner.rtype])\n    const entry = {\n        id: grouped_light.id,\n        state: grouped_light.on.on,\n        label: group.name,\n        scene: group.scene\n    }\n\n    model.push(entry)\n    \n}\n\nmsg.payload = model.sort((a, b) => {\n\n    return a.label.localeCompare(b.label)\n\n})\n\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 420,
        "y": 120,
        "wires": [
            [
                "d9ae737367ebed62"
            ]
        ]
    },
    {
        "id": "b10710b8c58d5e66",
        "type": "status",
        "z": "882c6d268bfa1aec",
        "name": "",
        "scope": [
            "fbd48fd0a48a3c31"
        ],
        "x": 580,
        "y": 240,
        "wires": [
            []
        ]
    },
    {
        "id": "d9ae737367ebed62",
        "type": "template",
        "z": "882c6d268bfa1aec",
        "name": "",
        "field": "template",
        "fieldType": "msg",
        "format": "html",
        "syntax": "plain",
        "template": "<div>\n    <div ng-repeat=\"model in msg.payload\">\n        <div ng-if=\"$index > 0\">\n            <hr>\n        </div>\n        <md-switch ng-value=\"model.state\" ng-model=\"model.state\"\n            ng-change=\"send({ topic: 'resource/grouped_light/' + model.id, payload: { on: { on:model.state } }, method: 'PUT' })\">\n            {{model.label}}\n        </md-switch>\n        <md-button style=\"display:inline-block;margin:1px\" ng-repeat=\"scene in model.scene\"\n            ng-click=\"send({topic: 'resource/scene/' + scene.id, payload: {recall:{action:'dynamic_palette'}}, method: 'PUT'})\">\n            {{scene.name}}\n        </md-button>\n    </div>\n</div>",
        "output": "str",
        "x": 580,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "485df563c6545698",
        "type": "join",
        "z": "cbd68ba9caa96a3d",
        "g": "98cf3b8910bc4f22",
        "name": "",
        "mode": "custom",
        "build": "object",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": true,
        "timeout": "",
        "count": "3",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 550,
        "y": 320,
        "wires": [
            [
                "1b5ab2bf7ea37b3b"
            ]
        ]
    },
    {
        "id": "1b5ab2bf7ea37b3b",
        "type": "switch",
        "z": "cbd68ba9caa96a3d",
        "g": "98cf3b8910bc4f22",
        "name": "automation enabled?",
        "property": "payload.enable",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 720,
        "y": 320,
        "wires": [
            [
                "8686957868613221"
            ]
        ]
    },
    {
        "id": "1e6ace60764fec35",
        "type": "mqtt in",
        "z": "cbd68ba9caa96a3d",
        "g": "98cf3b8910bc4f22",
        "name": "",
        "topic": "nodered/automation/enable",
        "qos": "2",
        "datatype": "json",
        "broker": "722d62f3b93039c3",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 150,
        "y": 380,
        "wires": [
            [
                "6b40e38fa169c721",
                "784c9929fe789981"
            ]
        ]
    },
    {
        "id": "b2c19560f9da088a",
        "type": "function",
        "z": "cbd68ba9caa96a3d",
        "g": "8a031cfeade40a06",
        "name": "daily",
        "func": "/*global suncalc*/\n\nconst date = new Date()\n\n////////////////////////////////////////////////////////////////\n// sunrise, sunset\n\nconst latitude = env.get('LATITUDE')\nconst longitude = env.get('LONGITUDE')\nconst times = suncalc.getTimes(date, latitude, longitude)\nconst start = times.sunrise.getTime()\nconst end = times.sunset.getTime()\n\nconst payload = {\n    sunrise: start,\n    sunset: end,\n    zenith: {}\n}\n\n////////////////////////////////////////////////////////////////\n// midday, afternoon\n\nfor (let minute = start; minute < end; minute += 60000) {\n\n    const d = new Date(minute)\n    const current = payload.zenith.altitude || -100\n    const position = suncalc.getPosition(d, latitude, longitude)\n\n    if (position.altitude > current) {\n\n        payload.zenith = {\n            altitude: position.altitude,\n            azimuth: position.azimuth,\n            time: minute\n        }\n    }\n}\n\nconst offset = 7200000\npayload.midday = payload.zenith.time - offset\npayload.afternoon = payload.zenith.time + offset\n\n////////////////////////////////////////////////////////////////\n// bedtime\n\ndate.setHours(22, 0, 0, 0)\n\nconst bedtime = 1800000 - Math.floor(Math.random() * 3600000)\n\npayload.bedtime = bedtime + date.getTime()\n\nif (payload.bedtime < payload.sunset) {\n\n    payload.bedtime = payload.sunset + 1800000\n\n}\n\n////////////////////////////////////////////////////////////////\n// theme\n\nconst month = date.getMonth() + 1\nconst day = date.getDate()\n\nif (month == 7 && day <= 4) {\n\n    payload.theme = 'tribal'\n\n} else if (month == 10) {\n\n    payload.theme = 'spooky'\n\n} else if (month == 12) {\n\n    payload.theme = 'jolly'\n\n} else {\n\n    payload.theme = 'standard'\n\n}\n\n////////////////////////////////////////////////////////////////\n\nmsg.payload = payload\nmsg.topic = 'daily'\n\nnode.status({\n    text: new Date(msg.payload.bedtime).toLocaleTimeString(),\n    shape: 'dot',\n    fill: 'blue'\n})\n\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "suncalc",
                "module": "suncalc"
            }
        ],
        "x": 290,
        "y": 80,
        "wires": [
            [
                "c9d02aeed7d0407f"
            ]
        ],
        "info": "Use [suncalc](https://www.npmjs.com/package/suncalc) and various `Date` based calculations to determine a number of values for subsequent use in driving time-based home automation. This function will emit a JavaScript object each time it is invoked.\n\n### Configuration\n\nThis function relies on two environment variables, `LATITUDE` and `LONGITUDE` which must be set to the gegraphic coordinates of the home, in decimal degrees.\n\n### Input\n\nNone (incoming message is ignored).\n\n### Output\n\n> All _timestamp_ values are integers of the kind returned by the JavaScript `Date.getTime()` method.\n\n> Such timestamp values may be in the past or in the future depending on the exact time of day on which this function is invoked.\n\n> All angles are expressed as floating-point number of radians.\n\n| Property                      | Description                                                                                           |\n|-------------------------------|-------------------------------------------------------------------------------------------------------|\n| `msg.payload.sunrise`         | The timestamp at which the sun will have started to appear on the current day                         |\n| `msg.payload.sunset`          | The timestamp at which the sun will have disappeared on the current day                               |\n| `msg.payload.zenith.time`     | The timestamp at which the sun will have reached its maximum altitude on the current day              |\n| `msg.payload.zenith.altitude` | The maximum altitude the sun will reach on the current day                                            |\n| `msg.payload.zenith.azimuth`  | The azimuth of the sun at the time it will have reached its maximum altitude on the current day       |\n| `msg.payload.midday`          | The timestamp at which \"midday\" will have begun on the current day                                    |\n| `msg.payload.afternoon`       | The timestamp at which \"afternoon\" will have begun on the current day                                 |\n| `msg.payload.bedtime`         | The timestamp of the randomly generated time at which \"bed time\" will have begun on the current day   |\n| `msg.payload.theme`           | A string describing the time of year for the current year, as described below                         |\n\nThe value of `msg.payload.theme` will be one of the following:\n\n| Value      | Description                           |\n|------------|---------------------------------------|\n| `tribal`   | July 1 - 4 (US Independence Day)      |\n| `spooky`   | Any day in October (Halloween)        |\n| `jolly`    | Any day in December (Winter Solstice) |\n| `standard` | Any other day                         |\n\n### Details\n\nThis function is assumed to be invoked once when the flow is started and then once per 24 hour period, some time between midnight and sunrise. Its output will be joined later in the flow with a timestamp sent once per minute throughout every day in order to drive time-of-day based automation.\n\nThe value of `msg.payload.theme` can be used, for example, to select a custom lighting scheme for certain festivities oppropriate to a given time of year.\n\nThe value of `msg.payload.zenith.time` is used to calculate the values for `msg.payload.midday` and `msg.payload.afternoon`. The intent is to provide enough information, for example, to drive east- vs west-facing window covering automation.\n\nNote that later in the flow all of these `msg.payload` properties will be split into separate MQTT topics. The intent is to drive home automation by receipt of such MQTT events rather than directly using the output of this function."
    },
    {
        "id": "a0c7d328b5287989",
        "type": "inject",
        "z": "cbd68ba9caa96a3d",
        "g": "8a031cfeade40a06",
        "name": "at start",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 160,
        "y": 60,
        "wires": [
            [
                "b2c19560f9da088a"
            ]
        ]
    },
    {
        "id": "8c6c3c20f5958599",
        "type": "inject",
        "z": "cbd68ba9caa96a3d",
        "g": "8a031cfeade40a06",
        "name": "every morning",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "00 02 * * *",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 140,
        "y": 100,
        "wires": [
            [
                "b2c19560f9da088a"
            ]
        ]
    },
    {
        "id": "a0b61336a93a4089",
        "type": "inject",
        "z": "cbd68ba9caa96a3d",
        "g": "8a031cfeade40a06",
        "name": "every minute",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "60",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "now",
        "payload": "",
        "payloadType": "date",
        "x": 260,
        "y": 160,
        "wires": [
            [
                "c9d02aeed7d0407f"
            ]
        ]
    },
    {
        "id": "c9d02aeed7d0407f",
        "type": "join",
        "z": "cbd68ba9caa96a3d",
        "g": "8a031cfeade40a06",
        "name": "",
        "mode": "custom",
        "build": "object",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": true,
        "timeout": "",
        "count": "2",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 430,
        "y": 120,
        "wires": [
            [
                "d534f07cf7c1eb0b"
            ]
        ]
    },
    {
        "id": "d534f07cf7c1eb0b",
        "type": "function",
        "z": "cbd68ba9caa96a3d",
        "g": "8a031cfeade40a06",
        "name": "now",
        "func": "/*global suncalc*/\n\nconst date = new Date(msg.payload.now)\nconst latitude = env.get('LATITUDE')\nconst longitude = env.get('LONGITUDE')\nconst position = suncalc.getPosition(date, latitude, longitude)\n\nconst payload = {\n    now: msg.payload.now,\n    altitude: position.altitude,\n    azimuth: position.azimuth\n}\n\nfor (const key in msg.payload.daily) {\n\n    payload[key] = msg.payload.daily[key]\n\n}\n\nif (payload.now > payload.sunrise && payload.now < payload.bedtime) {\n\n    if (payload.now < payload.midday) {\n\n        payload.time = 'morning'\n\n    } else if (payload.now < payload.afternoon) {\n\n        payload.time = 'midday'\n\n    } else if (payload.now < payload.sunset) {\n\n        payload.time = 'afternoon'\n\n    } else {\n\n        payload.time = 'evening'\n\n    }\n\n} else {\n\n    payload.time = 'night'\n\n}\n\nnode.status({\n    text: payload.time,\n    shape: 'dot',\n    fill: 'blue'\n})\n\n/**\n* @param {string} topic\n* @param {{ [x: string]: any; now?: any; altitude?: any; azimuth?: any; }} payload\n* @param {{ topic: string; payload: any; qos: number; retain: boolean; }[]} msgs\n*/\nfunction splitPayload(topic, payload, msgs) {\n\n    for (const key in payload) {\n\n        const value = payload[key]\n\n        if ((typeof value) == 'object') {\n\n            msgs = msgs.concat(splitPayload(topic + key + '/', value, []))\n\n        } else {\n\n            msgs.push({\n                topic: topic + key,\n                payload: value\n            })\n        }\n    }\n\n    return msgs\n\n}\n\nconst msgs = splitPayload('', payload, [])\n\nreturn [msgs]",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "suncalc",
                "module": "suncalc"
            }
        ],
        "x": 550,
        "y": 120,
        "wires": [
            [
                "b709b48ce2961f8e"
            ]
        ],
        "info": "Use the output of the _daily_ function node, joined with a timestamp sent every minute, to send a number of output messages periodically to drive time-based home automation.\n\n### Configuration\n\nThis function uses [suncalc](https://www.npmjs.com/package/suncalc) to determine the sun's current position. It assumes that the `LATITUDE` and `LONGITUDE` environment variables are set to the home's geographic coordinates.\n\n### Input\n\nThis function operates on `msg.payload` to produce a number of individual output messages each time it is invoked:\n\n| Property            | Description                                                                     |\n|---------------------|---------------------------------------------------------------------------------|\n| `msg.payload.now`   | The timestamp for the current time, each minute                                 |\n| `msg.payload.daily` | JavaScript object sent once per day by the `function` node named _daily_ (q.v.) |\n\n### Output\n\nThis function will emit a number of individual messages each time it is invoked. These messages will correspond to each of the input `msg.payload` properties split into separate, MQTT-friendly events. Each such event message will be one of the following:\n\n| `msg.topic`       | `msg.payload`                                                   |\n|-------------------|-----------------------------------------------------------------|\n| `now`             | The value of the input `msg.payload.now`                        |\n| `altitude`        | The sun's altitude at the time specified by `msg.payload.now`   |\n| `azimuth`         | The sun's azimuth at the time specified by `msg.payload.now`    |\n| `sunrise`         | The value the input `msg.payload.daily.sunrise`                 |\n| `sunset`          | The value the input `msg.payload.daily.sunset`                  |\n| `zenith/altitude` | The value the input `msg.payload.daily.zenith.altitude`         |\n| `zenith/azimuth`  | The value the input `msg.payload.daily.zenith.azimuth`          |\n| `zenith/time`     | The value the input `msg.payload.daily.zenith.time`             |\n| `midday`          | The value the input `msg.payload.daily.midday`                  |\n| `afternoon`       | The value the input `msg.payload.daily.afternoon`               |\n| `bedtime`         | The value the input `msg.payload.daily.bedtime`                 |\n| `theme`           | The value the input `msg.payload.daily.theme`                   |\n| `time`            | A string describing the current time of day, as described below |\n\nThe value of the `time` topic will be one of the following strings:\n\n| `time`      | Description                               |\n|-------------|-------------------------------------------|\n| `morning`   | `now` is between `sunrise` and `midday`   |\n| `midday`    | `now` is between `midday` and `afternoon` |\n| `afternoon` | `now` is between `afternoon` and `sunset` |\n| `evening`   | `now` is between `sunset` and `bedtime`   |\n| `night`     | otherwise                                 |\n\n> While five distinct times of day may seem excessive, it is actually quite useful for things like window covering automation. For example, `midday` indicates the time at which it is safe to open east-facing window coverings will `afternoon` indicates the time at which west-facing coverings may need to be closed.\n\n### Details\n\nThis function exists to calculate the value of the `time` topic based on the current time of day and then to forward that value and its various inputs from the _daily_ function as individual events. While this function sends these messages once per minute, the assumption is that a subsequent `filter` node will be used to send MQTT messages only when the payload for a given topic actually changes. For most of the messages sent as outputs from this function that means they should actually be sent as MQTT messages once per 24 hour period. The `time` topic should be sent five times per 24 hours. Only the `now` topic should be sent every minute via MQTT.\n\n> The `now` topic is sent for completeness, but could be useful in some hypothetical scenarios such as to drive \"keep alive\" messaging or watchdog timers.\n\n> There is a subsequent `change` node in the flow in which this function is invoked that prepends a base topic to each message. So to listen for `time` messages you should actually subscribe to the `nodered/automation/time` topic. Use `nodered/automation/theme` to receive `theme` events. And so on."
    },
    {
        "id": "b709b48ce2961f8e",
        "type": "rbe",
        "z": "cbd68ba9caa96a3d",
        "g": "8a031cfeade40a06",
        "name": "",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "septopics": true,
        "property": "payload",
        "topi": "topic",
        "x": 670,
        "y": 120,
        "wires": [
            [
                "47875e1be48bbf82"
            ]
        ]
    },
    {
        "id": "47875e1be48bbf82",
        "type": "change",
        "z": "cbd68ba9caa96a3d",
        "g": "8a031cfeade40a06",
        "name": "'nodered/automation/' & topic",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "'nodered/automation/' & topic",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "qos",
                "pt": "msg",
                "to": "2",
                "tot": "num"
            },
            {
                "t": "set",
                "p": "retain",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 860,
        "y": 120,
        "wires": [
            [
                "4b2e5cdaca43a71b"
            ]
        ]
    },
    {
        "id": "784c9929fe789981",
        "type": "change",
        "z": "cbd68ba9caa96a3d",
        "g": "98cf3b8910bc4f22",
        "name": "truncate topic",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "$substringAfter(topic, 'nodered/automation/')",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 400,
        "y": 320,
        "wires": [
            [
                "485df563c6545698"
            ]
        ]
    },
    {
        "id": "6272a0d1ddf8807b",
        "type": "mqtt in",
        "z": "cbd68ba9caa96a3d",
        "g": "98cf3b8910bc4f22",
        "name": "",
        "topic": "nodered/automation/time",
        "qos": "2",
        "datatype": "utf8",
        "broker": "722d62f3b93039c3",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 150,
        "y": 260,
        "wires": [
            [
                "784c9929fe789981"
            ]
        ]
    },
    {
        "id": "2a94995efda1937e",
        "type": "mqtt in",
        "z": "cbd68ba9caa96a3d",
        "g": "98cf3b8910bc4f22",
        "name": "",
        "topic": "nodered/automation/theme",
        "qos": "2",
        "datatype": "utf8",
        "broker": "722d62f3b93039c3",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 150,
        "y": 320,
        "wires": [
            [
                "784c9929fe789981"
            ]
        ]
    },
    {
        "id": "6b40e38fa169c721",
        "type": "ui_switch",
        "z": "cbd68ba9caa96a3d",
        "g": "98cf3b8910bc4f22",
        "name": "Enable Automation",
        "label": "Enable",
        "tooltip": "",
        "group": "25c7f0078ed443dd",
        "order": 12,
        "width": 0,
        "height": 0,
        "passthru": false,
        "decouple": "true",
        "topic": "nodered/automation/enable",
        "topicType": "str",
        "style": "",
        "onvalue": "true",
        "onvalueType": "bool",
        "onicon": "",
        "oncolor": "",
        "offvalue": "false",
        "offvalueType": "bool",
        "officon": "",
        "offcolor": "",
        "animate": false,
        "className": "",
        "x": 410,
        "y": 440,
        "wires": [
            [
                "56ed153e71b59e89"
            ]
        ],
        "info": "Dashboard switch to control whether or not the automation flows will be triggered on receipt of `nodered/automation/time` MQTT events."
    },
    {
        "id": "4b2e5cdaca43a71b",
        "type": "link out",
        "z": "cbd68ba9caa96a3d",
        "g": "8a031cfeade40a06",
        "name": "send to broker",
        "mode": "link",
        "links": [
            "b9100b6a29fef164",
            "efbd1b79e54e0bf7"
        ],
        "x": 1015,
        "y": 120,
        "wires": []
    },
    {
        "id": "00b200c8b96373d9",
        "type": "link out",
        "z": "cbd68ba9caa96a3d",
        "g": "98cf3b8910bc4f22",
        "name": "send to broker",
        "mode": "link",
        "links": [
            "b9100b6a29fef164",
            "efbd1b79e54e0bf7"
        ],
        "x": 795,
        "y": 440,
        "wires": []
    },
    {
        "id": "56ed153e71b59e89",
        "type": "change",
        "z": "cbd68ba9caa96a3d",
        "g": "98cf3b8910bc4f22",
        "name": "nodered/automation/enable",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "nodered/automation/enable",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "qos",
                "pt": "msg",
                "to": "2",
                "tot": "num"
            },
            {
                "t": "set",
                "p": "retain",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 640,
        "y": 440,
        "wires": [
            [
                "00b200c8b96373d9"
            ]
        ]
    },
    {
        "id": "a9ea7694289d75de",
        "type": "link out",
        "z": "cbd68ba9caa96a3d",
        "g": "98cf3b8910bc4f22",
        "name": "time",
        "mode": "link",
        "links": [
            "d83eb703d52610ad",
            "ea959d418216fe68",
            "0d2088c48deebf62",
            "4bb92f343cc9a859"
        ],
        "x": 1235,
        "y": 320,
        "wires": []
    },
    {
        "id": "dcae4a0dbbe2575e",
        "type": "comment",
        "z": "cbd68ba9caa96a3d",
        "g": "8a031cfeade40a06",
        "name": "send nodered/automation/+ events...",
        "info": "",
        "x": 880,
        "y": 80,
        "wires": []
    },
    {
        "id": "a01e15ec8fb87e05",
        "type": "comment",
        "z": "cbd68ba9caa96a3d",
        "g": "98cf3b8910bc4f22",
        "name": "execute automation...",
        "info": "",
        "x": 1140,
        "y": 280,
        "wires": []
    },
    {
        "id": "df682692b16a598e",
        "type": "comment",
        "z": "cbd68ba9caa96a3d",
        "g": "98cf3b8910bc4f22",
        "name": "send nodered/automation/enable events...",
        "info": "",
        "x": 640,
        "y": 400,
        "wires": []
    },
    {
        "id": "17fde856a49a6028",
        "type": "rbe",
        "z": "cbd68ba9caa96a3d",
        "g": "98cf3b8910bc4f22",
        "name": "",
        "func": "rbei",
        "gap": "",
        "start": "",
        "inout": "out",
        "septopics": false,
        "property": "payload",
        "topi": "topic",
        "x": 1150,
        "y": 320,
        "wires": [
            [
                "a9ea7694289d75de"
            ]
        ]
    },
    {
        "id": "8686957868613221",
        "type": "change",
        "z": "cbd68ba9caa96a3d",
        "g": "98cf3b8910bc4f22",
        "name": "",
        "rules": [
            {
                "t": "delete",
                "p": "payload.enable",
                "pt": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 960,
        "y": 320,
        "wires": [
            [
                "17fde856a49a6028"
            ]
        ]
    },
    {
        "id": "65ab6145dd1c2e19",
        "type": "switch",
        "z": "ff0141ba0f0c7234",
        "g": "78e09083a861e13e",
        "name": "time",
        "property": "payload.time",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "morning",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "midday",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "afternoon",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "evening",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "night",
                "vt": "str"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 5,
        "x": 1030,
        "y": 480,
        "wires": [
            [
                "b13e36ae61e678c5"
            ],
            [
                "92c2876f08baadd9"
            ],
            [
                "55f89a635c93f337"
            ],
            [
                "5638c682e2ac2fba"
            ],
            [
                "5a10fc701135b50d"
            ]
        ],
        "inputLabels": [
            "suncalc"
        ],
        "outputLabels": [
            "morning",
            "midday",
            "afternoon",
            "evening",
            "night"
        ]
    },
    {
        "id": "b13e36ae61e678c5",
        "type": "link out",
        "z": "ff0141ba0f0c7234",
        "g": "78e09083a861e13e",
        "name": "morning",
        "mode": "link",
        "links": [
            "cab89ebfeca22623"
        ],
        "x": 1195,
        "y": 400,
        "wires": []
    },
    {
        "id": "92c2876f08baadd9",
        "type": "link out",
        "z": "ff0141ba0f0c7234",
        "g": "78e09083a861e13e",
        "name": "midday",
        "mode": "link",
        "links": [
            "4d9c62d6c2145813"
        ],
        "x": 1195,
        "y": 440,
        "wires": []
    },
    {
        "id": "55f89a635c93f337",
        "type": "link out",
        "z": "ff0141ba0f0c7234",
        "g": "78e09083a861e13e",
        "name": "afternoon",
        "mode": "link",
        "links": [
            "3fa2af1c1f32f8ee"
        ],
        "x": 1195,
        "y": 480,
        "wires": []
    },
    {
        "id": "5638c682e2ac2fba",
        "type": "link out",
        "z": "ff0141ba0f0c7234",
        "g": "78e09083a861e13e",
        "name": "evening",
        "mode": "link",
        "links": [
            "4d9c62d6c2145813"
        ],
        "x": 1195,
        "y": 520,
        "wires": []
    },
    {
        "id": "5a10fc701135b50d",
        "type": "link out",
        "z": "ff0141ba0f0c7234",
        "g": "78e09083a861e13e",
        "name": "night",
        "mode": "link",
        "links": [
            "71f42f61777d49d9"
        ],
        "x": 1195,
        "y": 560,
        "wires": []
    },
    {
        "id": "ea959d418216fe68",
        "type": "link in",
        "z": "ff0141ba0f0c7234",
        "g": "78e09083a861e13e",
        "name": "time",
        "links": [
            "a9ea7694289d75de"
        ],
        "x": 935,
        "y": 480,
        "wires": [
            [
                "65ab6145dd1c2e19"
            ]
        ]
    },
    {
        "id": "59e320abec722230",
        "type": "link out",
        "z": "ff0141ba0f0c7234",
        "g": "053656a9e6f3379c",
        "name": "morning",
        "mode": "link",
        "links": [
            "2bb38044a932fa69",
            "52f0cba3f9b87632",
            "df41f3a116d28de2"
        ],
        "x": 415,
        "y": 340,
        "wires": []
    },
    {
        "id": "52a74204d47efd1e",
        "type": "link out",
        "z": "ff0141ba0f0c7234",
        "g": "053656a9e6f3379c",
        "name": "night",
        "mode": "link",
        "links": [
            "012902774c9657f1",
            "0acba8178934baa1",
            "2bb38044a932fa69"
        ],
        "x": 415,
        "y": 580,
        "wires": []
    },
    {
        "id": "9b05a84bf2e36872",
        "type": "link out",
        "z": "ff0141ba0f0c7234",
        "g": "053656a9e6f3379c",
        "name": "tribal",
        "mode": "link",
        "links": [
            "510f4653645e17d0"
        ],
        "x": 615,
        "y": 360,
        "wires": []
    },
    {
        "id": "6051debe54e3825e",
        "type": "link out",
        "z": "ff0141ba0f0c7234",
        "g": "053656a9e6f3379c",
        "name": "spooky",
        "mode": "link",
        "links": [
            "feaf54e6c16337c1"
        ],
        "x": 615,
        "y": 400,
        "wires": []
    },
    {
        "id": "13ec2fe1e16094a1",
        "type": "link out",
        "z": "ff0141ba0f0c7234",
        "g": "053656a9e6f3379c",
        "name": "jolly",
        "mode": "link",
        "links": [
            "510f4653645e17d0",
            "cb0bc87b9e465a2f",
            "feaf54e6c16337c1"
        ],
        "x": 615,
        "y": 440,
        "wires": []
    },
    {
        "id": "84118b9049ec3439",
        "type": "link out",
        "z": "ff0141ba0f0c7234",
        "g": "053656a9e6f3379c",
        "name": "standard",
        "mode": "link",
        "links": [
            "b11c745f6ce17117"
        ],
        "x": 615,
        "y": 480,
        "wires": []
    },
    {
        "id": "4bb92f343cc9a859",
        "type": "link in",
        "z": "ff0141ba0f0c7234",
        "g": "053656a9e6f3379c",
        "name": "time",
        "links": [
            "a9ea7694289d75de"
        ],
        "x": 175,
        "y": 460,
        "wires": [
            [
                "06e95c81925fd3c3"
            ]
        ]
    },
    {
        "id": "74f456c57bd0405f",
        "type": "delay",
        "z": "ff0141ba0f0c7234",
        "g": "276fb48c5a5f5cf0",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "3",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 290,
        "y": 100,
        "wires": [
            [
                "3db511b8fbb93369"
            ]
        ]
    },
    {
        "id": "3db511b8fbb93369",
        "type": "mqtt out",
        "z": "ff0141ba0f0c7234",
        "g": "276fb48c5a5f5cf0",
        "name": "",
        "topic": "",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "722d62f3b93039c3",
        "x": 430,
        "y": 100,
        "wires": []
    },
    {
        "id": "efbd1b79e54e0bf7",
        "type": "link in",
        "z": "ff0141ba0f0c7234",
        "g": "276fb48c5a5f5cf0",
        "name": "send to broker",
        "links": [
            "4b2e5cdaca43a71b",
            "968fd6d85ac60a62",
            "54bbaac5bafb7512",
            "00b200c8b96373d9",
            "01dabb1829a3e85e",
            "22a8b1377a9c1022"
        ],
        "x": 175,
        "y": 100,
        "wires": [
            [
                "74f456c57bd0405f"
            ]
        ]
    },
    {
        "id": "d935f691d63e1e77",
        "type": "status",
        "z": "ff0141ba0f0c7234",
        "g": "276fb48c5a5f5cf0",
        "name": "mqtt queue status",
        "scope": [
            "74f456c57bd0405f"
        ],
        "x": 270,
        "y": 160,
        "wires": [
            [
                "3a71b6d844f7acb7"
            ]
        ]
    },
    {
        "id": "ec3b19f7f91f026d",
        "type": "status",
        "z": "ff0141ba0f0c7234",
        "g": "276fb48c5a5f5cf0",
        "name": "mqtt connection status",
        "scope": [
            "3db511b8fbb93369"
        ],
        "x": 260,
        "y": 200,
        "wires": [
            [
                "4f8791884f618315"
            ]
        ]
    },
    {
        "id": "1a9f2ae66bc3b97b",
        "type": "ui_text",
        "z": "ff0141ba0f0c7234",
        "g": "276fb48c5a5f5cf0",
        "group": "d198490f207c2a62",
        "order": 1,
        "width": 0,
        "height": 0,
        "name": "MQTT Queue Status",
        "label": "Queue",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 640,
        "y": 160,
        "wires": []
    },
    {
        "id": "c985b6125c7dee4a",
        "type": "ui_text",
        "z": "ff0141ba0f0c7234",
        "g": "276fb48c5a5f5cf0",
        "group": "d198490f207c2a62",
        "order": 2,
        "width": 0,
        "height": 0,
        "name": "MQTT Connection Status",
        "label": "Queue",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 650,
        "y": 200,
        "wires": []
    },
    {
        "id": "3a71b6d844f7acb7",
        "type": "change",
        "z": "ff0141ba0f0c7234",
        "g": "276fb48c5a5f5cf0",
        "name": "parse status",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "$substringAfter(status.text, 'node-red:common.status.')",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 450,
        "y": 160,
        "wires": [
            [
                "1a9f2ae66bc3b97b"
            ]
        ]
    },
    {
        "id": "4f8791884f618315",
        "type": "change",
        "z": "ff0141ba0f0c7234",
        "g": "276fb48c5a5f5cf0",
        "name": "parse status",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "$substringAfter(status.text, 'node-red:common.status.')",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 450,
        "y": 200,
        "wires": [
            [
                "c985b6125c7dee4a"
            ]
        ]
    },
    {
        "id": "af1881c6e1166196",
        "type": "comment",
        "z": "ff0141ba0f0c7234",
        "g": "276fb48c5a5f5cf0",
        "name": "send all mqtt messages through this link",
        "info": "",
        "x": 310,
        "y": 60,
        "wires": []
    },
    {
        "id": "34385092a355cd47",
        "type": "comment",
        "z": "ff0141ba0f0c7234",
        "g": "053656a9e6f3379c",
        "name": "handle nodered/automation/time events",
        "info": "",
        "x": 310,
        "y": 300,
        "wires": []
    },
    {
        "id": "6d664c1fce229c1e",
        "type": "comment",
        "z": "ff0141ba0f0c7234",
        "g": "78e09083a861e13e",
        "name": "handle nodered/automation/time events",
        "info": "",
        "x": 1070,
        "y": 360,
        "wires": []
    },
    {
        "id": "06e95c81925fd3c3",
        "type": "switch",
        "z": "ff0141ba0f0c7234",
        "g": "053656a9e6f3379c",
        "name": "time",
        "property": "payload.time",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "morning",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "evening",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "night",
                "vt": "str"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 3,
        "x": 270,
        "y": 460,
        "wires": [
            [
                "59e320abec722230"
            ],
            [
                "ded409ca4a47d4fa"
            ],
            [
                "52a74204d47efd1e"
            ]
        ],
        "info": "// nrlint no-overlapping-nodes:off\n"
    },
    {
        "id": "8a9ced356d9b863b",
        "type": "switch",
        "z": "ff0141ba0f0c7234",
        "g": "053656a9e6f3379c",
        "name": "theme",
        "property": "payload.theme",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "tribal",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "spooky",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "jolly",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 4,
        "x": 450,
        "y": 420,
        "wires": [
            [
                "9b05a84bf2e36872"
            ],
            [
                "6051debe54e3825e"
            ],
            [
                "13ec2fe1e16094a1"
            ],
            [
                "84118b9049ec3439"
            ]
        ],
        "info": "// nrlint no-overlapping-nodes:off\n"
    },
    {
        "id": "6957440564321846",
        "type": "link out",
        "z": "ff0141ba0f0c7234",
        "g": "053656a9e6f3379c",
        "name": "evening",
        "mode": "link",
        "links": [
            "fe5fdd858e8b907d"
        ],
        "x": 415,
        "y": 500,
        "wires": []
    },
    {
        "id": "7df3e5fbd6e9aa8a",
        "type": "link in",
        "z": "c7141ffb22d64190",
        "g": "70e9b8db12799d18",
        "name": "send to ground floor hue",
        "links": [
            "ad6148753504feb8",
            "5453ecd10d2275d7",
            "b377dfca55193e3b",
            "5539f5e5fa8f4bb2",
            "b91aabd7ec998121"
        ],
        "x": 55,
        "y": 440,
        "wires": [
            [
                "3b5ab296575b53d4"
            ]
        ],
        "outputLabels": [
            "topic = uri, payload = body, method = HTTP request type"
        ]
    },
    {
        "id": "3b5ab296575b53d4",
        "type": "subflow:5785c8d9f39df67e",
        "z": "c7141ffb22d64190",
        "g": "70e9b8db12799d18",
        "name": "",
        "env": [
            {
                "name": "ADDRESS",
                "value": "GROUND_FLOOR_HUE_ADDRESS",
                "type": "env"
            },
            {
                "name": "KEY",
                "value": "GROUND_FLOOR_HUE_KEY",
                "type": "env"
            }
        ],
        "x": 190,
        "y": 440,
        "wires": [
            [
                "44f0fb819452b7aa"
            ]
        ]
    },
    {
        "id": "51bce99c75aa12c6",
        "type": "inject",
        "z": "c7141ffb22d64190",
        "g": "290b83ef8e01ae0f",
        "name": "create key",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 120,
        "y": 100,
        "wires": [
            [
                "73a1ec5ed8ebc167"
            ]
        ]
    },
    {
        "id": "f3ab10cd192709b0",
        "type": "debug",
        "z": "c7141ffb22d64190",
        "g": "290b83ef8e01ae0f",
        "name": "ground floor application key",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": true,
        "complete": "true",
        "targetType": "full",
        "statusVal": "payload",
        "statusType": "msg",
        "x": 580,
        "y": 100,
        "wires": []
    },
    {
        "id": "73a1ec5ed8ebc167",
        "type": "subflow:75bc72a16c4da2c8",
        "z": "c7141ffb22d64190",
        "g": "290b83ef8e01ae0f",
        "name": "",
        "env": [
            {
                "name": "ADDRESS",
                "value": "GROUND_FLOOR_HUE_ADDRESS",
                "type": "env"
            },
            {
                "name": "USERNAME",
                "value": "nodered#groundfloor",
                "type": "str"
            }
        ],
        "x": 320,
        "y": 100,
        "wires": [
            [
                "f3ab10cd192709b0"
            ]
        ]
    },
    {
        "id": "7d283a2fc0d30093",
        "type": "subflow:4e89e7c952d56c09",
        "z": "c7141ffb22d64190",
        "g": "b0f5ce3a323b7dd7",
        "name": "",
        "env": [
            {
                "name": "ADDRESS",
                "value": "GROUND_FLOOR_HUE_ADDRESS",
                "type": "env"
            },
            {
                "name": "KEY",
                "value": "GROUND_FLOOR_HUE_KEY",
                "type": "env"
            },
            {
                "name": "TOPIC",
                "value": "GROUND_FLOOR_HUE_TOPIC",
                "type": "env"
            }
        ],
        "x": 110,
        "y": 540,
        "wires": [
            [
                "54bbaac5bafb7512"
            ]
        ]
    },
    {
        "id": "7def18ac26259af3",
        "type": "inject",
        "z": "c7141ffb22d64190",
        "g": "431ae4bdb7346af5",
        "name": "at start",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "3",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 120,
        "y": 220,
        "wires": [
            [
                "abb71db57910be2f"
            ]
        ]
    },
    {
        "id": "abb71db57910be2f",
        "type": "ui_button",
        "z": "c7141ffb22d64190",
        "g": "431ae4bdb7346af5",
        "name": "Refresh Ground Floor Controls",
        "group": "21f11f110d626f5a",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": true,
        "label": "Refresh",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "fa-refresh",
        "payload": "",
        "payloadType": "date",
        "topic": "topic",
        "topicType": "msg",
        "x": 330,
        "y": 220,
        "wires": [
            [
                "1ed4e6f41dea92e2"
            ]
        ]
    },
    {
        "id": "54bbaac5bafb7512",
        "type": "link out",
        "z": "c7141ffb22d64190",
        "g": "b0f5ce3a323b7dd7",
        "name": "send to broker",
        "mode": "link",
        "links": [
            "b9100b6a29fef164",
            "efbd1b79e54e0bf7"
        ],
        "x": 215,
        "y": 540,
        "wires": []
    },
    {
        "id": "edd68fdd0863619a",
        "type": "comment",
        "z": "c7141ffb22d64190",
        "g": "290b83ef8e01ae0f",
        "name": "use this to create the value to pass as the ${KEY} parameter in various subflows",
        "info": "",
        "x": 320,
        "y": 60,
        "wires": []
    },
    {
        "id": "1ed4e6f41dea92e2",
        "type": "subflow:da7c0eae8eb34f5a",
        "z": "c7141ffb22d64190",
        "g": "431ae4bdb7346af5",
        "name": "",
        "env": [
            {
                "name": "ADDRESS",
                "value": "GROUND_FLOOR_HUE_ADDRESS",
                "type": "env"
            },
            {
                "name": "KEY",
                "value": "GROUND_FLOOR_HUE_KEY",
                "type": "env"
            },
            {
                "name": "TOPIC",
                "value": "GROUND_FLOOR_HUE_TOPIC",
                "type": "env"
            },
            {
                "name": "TARGET",
                "value": "send to ground floor hue",
                "type": "str"
            }
        ],
        "x": 570,
        "y": 220,
        "wires": [
            [
                "22a8b1377a9c1022"
            ],
            [
                "e78baddb570f92fa"
            ]
        ]
    },
    {
        "id": "2bb38044a932fa69",
        "type": "link in",
        "z": "c7141ffb22d64190",
        "g": "f8dce80b21d7f706",
        "name": "yard off",
        "links": [
            "549a2335fb839c37",
            "981dbc2364b09d66",
            "e53fa5ad2c0bc25a",
            "4c171923173c6e68",
            "23eec62f6bec1030",
            "b290a3d4ebcd7653",
            "5950aa6c0df32eb2",
            "4ed8bcf218333395",
            "59e320abec722230",
            "52a74204d47efd1e"
        ],
        "x": 975,
        "y": 380,
        "wires": [
            [
                "64a68d2a2d2e93cd"
            ]
        ]
    },
    {
        "id": "64a68d2a2d2e93cd",
        "type": "change",
        "z": "c7141ffb22d64190",
        "g": "f8dce80b21d7f706",
        "name": "turn off",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"on\":{\"on\":false}}",
                "tot": "json"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "resource/grouped_light/bad8480b-b404-42d1-a9e7-a4a69f400971",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "method",
                "pt": "msg",
                "to": "PUT",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1090,
        "y": 380,
        "wires": [
            [
                "5539f5e5fa8f4bb2"
            ]
        ]
    },
    {
        "id": "b11c745f6ce17117",
        "type": "link in",
        "z": "c7141ffb22d64190",
        "g": "f8dce80b21d7f706",
        "name": "yard sunset",
        "links": [
            "e270017761dfd27d",
            "2272d3c9be7a6390",
            "bbabd588c05b979f",
            "b8723d53ddad808a",
            "84118b9049ec3439"
        ],
        "x": 975,
        "y": 420,
        "wires": [
            [
                "7e843abc77537f92"
            ]
        ]
    },
    {
        "id": "7e843abc77537f92",
        "type": "change",
        "z": "c7141ffb22d64190",
        "g": "f8dce80b21d7f706",
        "name": "sunset",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "resource/scene/9b6935e2-f8ed-4f91-83a2-2bff1850da99",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"recall\":{\"action\":\"dynamic_palette\"}}",
                "tot": "json"
            },
            {
                "t": "set",
                "p": "method",
                "pt": "msg",
                "to": "PUT",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1090,
        "y": 420,
        "wires": [
            [
                "5539f5e5fa8f4bb2"
            ]
        ]
    },
    {
        "id": "510f4653645e17d0",
        "type": "link in",
        "z": "c7141ffb22d64190",
        "g": "f8dce80b21d7f706",
        "name": "yard tribal",
        "links": [
            "b0ee0f2f8155fe9b",
            "7ab1620c3349854b",
            "ba11519631ca9918",
            "81221f83aad45655",
            "a63ed720004a623c",
            "83b840b1c5858876",
            "6a4e3c8d5c47d1b7",
            "758cfea08b622975",
            "9b05a84bf2e36872",
            "13ec2fe1e16094a1"
        ],
        "x": 975,
        "y": 460,
        "wires": [
            [
                "67013f62ca5bcb43"
            ]
        ]
    },
    {
        "id": "67013f62ca5bcb43",
        "type": "change",
        "z": "c7141ffb22d64190",
        "g": "f8dce80b21d7f706",
        "name": "tribal",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "resource/scene/c4681d32-3368-43cd-9cf1-436132521068",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"recall\":{\"action\":\"dynamic_palette\"}}",
                "tot": "json"
            },
            {
                "t": "set",
                "p": "method",
                "pt": "msg",
                "to": "PUT",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1090,
        "y": 460,
        "wires": [
            [
                "5539f5e5fa8f4bb2"
            ]
        ],
        "info": "// nrlint no-overlapping-nodes:off\n"
    },
    {
        "id": "feaf54e6c16337c1",
        "type": "link in",
        "z": "c7141ffb22d64190",
        "g": "f8dce80b21d7f706",
        "name": "yard spooky",
        "links": [
            "b0ee0f2f8155fe9b",
            "c68369c3781694e3",
            "d568e31cb3452775",
            "81221f83aad45655",
            "6c4e5524b478fb31",
            "83b840b1c5858876",
            "e0a9d45fbfcb3532",
            "758cfea08b622975",
            "6051debe54e3825e",
            "13ec2fe1e16094a1"
        ],
        "x": 975,
        "y": 500,
        "wires": [
            [
                "d92030613c5ce50e"
            ]
        ]
    },
    {
        "id": "d92030613c5ce50e",
        "type": "change",
        "z": "c7141ffb22d64190",
        "g": "f8dce80b21d7f706",
        "name": "spooky",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "resource/scene/70a0a8a6-b4b7-4b24-a9cf-0ecea0f359cc",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"recall\":{\"action\":\"dynamic_palette\"}}",
                "tot": "json"
            },
            {
                "t": "set",
                "p": "method",
                "pt": "msg",
                "to": "PUT",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1080,
        "y": 500,
        "wires": [
            [
                "5539f5e5fa8f4bb2"
            ]
        ]
    },
    {
        "id": "cb0bc87b9e465a2f",
        "type": "link in",
        "z": "c7141ffb22d64190",
        "g": "f8dce80b21d7f706",
        "name": "yard jolly",
        "links": [
            "b0ee0f2f8155fe9b",
            "81221f83aad45655",
            "83b840b1c5858876",
            "758cfea08b622975",
            "13ec2fe1e16094a1"
        ],
        "x": 975,
        "y": 540,
        "wires": [
            [
                "da79b96d161e1c28"
            ]
        ]
    },
    {
        "id": "da79b96d161e1c28",
        "type": "change",
        "z": "c7141ffb22d64190",
        "g": "f8dce80b21d7f706",
        "name": "jolly",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "resource/scene/12571f23-7714-4b47-8e75-a3040389b788",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"recall\":{\"action\":\"dynamic_palette\"}}",
                "tot": "json"
            },
            {
                "t": "set",
                "p": "method",
                "pt": "msg",
                "to": "PUT",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1090,
        "y": 540,
        "wires": [
            [
                "5539f5e5fa8f4bb2"
            ]
        ]
    },
    {
        "id": "52f0cba3f9b87632",
        "type": "link in",
        "z": "c7141ffb22d64190",
        "g": "b1ee6e019c90396d",
        "name": "main floor off",
        "links": [
            "981dbc2364b09d66",
            "e53fa5ad2c0bc25a",
            "23eec62f6bec1030",
            "5950aa6c0df32eb2",
            "59e320abec722230"
        ],
        "x": 1055,
        "y": 60,
        "wires": [
            [
                "72acc2a8bcbc1528"
            ]
        ]
    },
    {
        "id": "72acc2a8bcbc1528",
        "type": "change",
        "z": "c7141ffb22d64190",
        "g": "b1ee6e019c90396d",
        "name": "turn off",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "resource/grouped_light/9c1c7975-2f47-4552-bac8-c19b643cd678",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"on\":{\"on\":false}}",
                "tot": "json"
            },
            {
                "t": "set",
                "p": "method",
                "pt": "msg",
                "to": "PUT",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1170,
        "y": 60,
        "wires": [
            [
                "5453ecd10d2275d7"
            ]
        ]
    },
    {
        "id": "0acba8178934baa1",
        "type": "link in",
        "z": "c7141ffb22d64190",
        "g": "b1ee6e019c90396d",
        "name": "main floor nightlight",
        "links": [
            "549a2335fb839c37",
            "4c171923173c6e68",
            "b290a3d4ebcd7653",
            "4ed8bcf218333395",
            "52a74204d47efd1e"
        ],
        "x": 1055,
        "y": 100,
        "wires": [
            [
                "1c5888bd24d0a311"
            ]
        ]
    },
    {
        "id": "1c5888bd24d0a311",
        "type": "change",
        "z": "c7141ffb22d64190",
        "g": "b1ee6e019c90396d",
        "name": "night light",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "resource/scene/48c39b9f-1599-4a5c-b7f6-bad6cad4029a",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"recall\":{\"action\":\"active\"}}",
                "tot": "json"
            },
            {
                "t": "set",
                "p": "method",
                "pt": "msg",
                "to": "PUT",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1160,
        "y": 100,
        "wires": [
            [
                "5453ecd10d2275d7"
            ]
        ],
        "info": "// nrlint no-overlapping-nodes:off\n"
    },
    {
        "id": "fe5fdd858e8b907d",
        "type": "link in",
        "z": "c7141ffb22d64190",
        "g": "b1ee6e019c90396d",
        "name": "main floor sunset",
        "links": [
            "2837183323a61e04",
            "b77799d3430f62c7",
            "6f67a01c3ee8a16f",
            "b29a7ab55a3476e5",
            "6957440564321846"
        ],
        "x": 1055,
        "y": 140,
        "wires": [
            [
                "64afce8ff0b75f48"
            ]
        ]
    },
    {
        "id": "64afce8ff0b75f48",
        "type": "change",
        "z": "c7141ffb22d64190",
        "g": "b1ee6e019c90396d",
        "name": "sunset",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "resource/scene/6eff0801-01e2-4803-9840-e31c06cee079",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"recall\":{\"action\":\"dynamic_palette\"}}",
                "tot": "json"
            },
            {
                "t": "set",
                "p": "method",
                "pt": "msg",
                "to": "PUT",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1170,
        "y": 140,
        "wires": [
            [
                "5453ecd10d2275d7"
            ]
        ]
    },
    {
        "id": "df41f3a116d28de2",
        "type": "link in",
        "z": "c7141ffb22d64190",
        "g": "f848d645bd1abc5b",
        "name": "main bathroom off",
        "links": [
            "e696e0a2acb678c2",
            "f597e3f10639062f",
            "ce589288779cef4a",
            "981dbc2364b09d66",
            "e53fa5ad2c0bc25a",
            "23eec62f6bec1030",
            "5950aa6c0df32eb2",
            "59e320abec722230"
        ],
        "x": 1055,
        "y": 240,
        "wires": [
            [
                "a122f1a4fc3399e5"
            ]
        ]
    },
    {
        "id": "a122f1a4fc3399e5",
        "type": "change",
        "z": "c7141ffb22d64190",
        "g": "f848d645bd1abc5b",
        "name": "turn off",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"on\":{\"on\":false}}",
                "tot": "json"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "resource/grouped_light/aea74e74-d544-4d08-ad71-3b6665045256",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "method",
                "pt": "msg",
                "to": "PUT",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1170,
        "y": 240,
        "wires": [
            [
                "b377dfca55193e3b"
            ]
        ],
        "info": "// nrlint no-overlapping-nodes:off\n"
    },
    {
        "id": "012902774c9657f1",
        "type": "link in",
        "z": "c7141ffb22d64190",
        "g": "f848d645bd1abc5b",
        "name": "main bathroom nightlight",
        "links": [
            "1fa973a7d8e65e3c",
            "549a2335fb839c37",
            "4c171923173c6e68",
            "b290a3d4ebcd7653",
            "4ed8bcf218333395",
            "52a74204d47efd1e"
        ],
        "x": 1055,
        "y": 280,
        "wires": [
            [
                "90cec6147a7de28f"
            ]
        ]
    },
    {
        "id": "90cec6147a7de28f",
        "type": "change",
        "z": "c7141ffb22d64190",
        "g": "f848d645bd1abc5b",
        "name": "night light",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"recall\":{\"action\":\"active\"}}",
                "tot": "json"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "resource/scene/5d507fb6-89f6-459a-b327-0fffd0c6dc48",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "method",
                "pt": "msg",
                "to": "PUT",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1160,
        "y": 280,
        "wires": [
            [
                "b377dfca55193e3b"
            ]
        ],
        "info": "// nrlint no-overlapping-nodes:off\n"
    },
    {
        "id": "44f0fb819452b7aa",
        "type": "subflow:7b61502c01a97f85",
        "z": "c7141ffb22d64190",
        "g": "70e9b8db12799d18",
        "name": "",
        "x": 390,
        "y": 440,
        "wires": []
    },
    {
        "id": "e78baddb570f92fa",
        "type": "subflow:7b61502c01a97f85",
        "z": "c7141ffb22d64190",
        "g": "431ae4bdb7346af5",
        "name": "",
        "x": 770,
        "y": 240,
        "wires": []
    },
    {
        "id": "5453ecd10d2275d7",
        "type": "link out",
        "z": "c7141ffb22d64190",
        "g": "b1ee6e019c90396d",
        "name": "send to ground floor hue",
        "mode": "link",
        "links": [
            "7df3e5fbd6e9aa8a"
        ],
        "x": 1275,
        "y": 100,
        "wires": []
    },
    {
        "id": "b377dfca55193e3b",
        "type": "link out",
        "z": "c7141ffb22d64190",
        "g": "f848d645bd1abc5b",
        "name": "send to ground floor hue",
        "mode": "link",
        "links": [
            "7df3e5fbd6e9aa8a"
        ],
        "x": 1255,
        "y": 260,
        "wires": []
    },
    {
        "id": "5539f5e5fa8f4bb2",
        "type": "link out",
        "z": "c7141ffb22d64190",
        "g": "f8dce80b21d7f706",
        "name": "send to ground floor hue",
        "mode": "link",
        "links": [
            "7df3e5fbd6e9aa8a"
        ],
        "x": 1255,
        "y": 460,
        "wires": []
    },
    {
        "id": "c11e7d50f626ad85",
        "type": "subflow:882c6d268bfa1aec",
        "z": "c7141ffb22d64190",
        "g": "d4fbb88ed29d4d7f",
        "name": "",
        "env": [
            {
                "name": "TOPIC",
                "value": "hue/ground-floor-hue/grouped_light/+",
                "type": "str"
            }
        ],
        "x": 150,
        "y": 340,
        "wires": [
            [
                "f4e7f3f6609ec608"
            ]
        ]
    },
    {
        "id": "f4e7f3f6609ec608",
        "type": "ui_template",
        "z": "c7141ffb22d64190",
        "g": "d4fbb88ed29d4d7f",
        "group": "21f11f110d626f5a",
        "name": "Ground Floor Hue Controls",
        "order": 2,
        "width": "6",
        "height": "24",
        "format": "",
        "storeOutMessages": false,
        "fwdInMessages": false,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 400,
        "y": 340,
        "wires": [
            [
                "b91aabd7ec998121"
            ]
        ]
    },
    {
        "id": "b91aabd7ec998121",
        "type": "link out",
        "z": "c7141ffb22d64190",
        "g": "d4fbb88ed29d4d7f",
        "name": "send to ground floor hue",
        "mode": "link",
        "links": [
            "7df3e5fbd6e9aa8a"
        ],
        "x": 555,
        "y": 340,
        "wires": []
    },
    {
        "id": "22a8b1377a9c1022",
        "type": "link out",
        "z": "c7141ffb22d64190",
        "g": "431ae4bdb7346af5",
        "name": "send to broker",
        "mode": "link",
        "links": [
            "efbd1b79e54e0bf7"
        ],
        "x": 695,
        "y": 200,
        "wires": []
    },
    {
        "id": "64274eb0d8b9e5dd",
        "type": "link in",
        "z": "810a8b527afd2b1b",
        "g": "cde8d276df445e2f",
        "name": "send to basement hue",
        "links": [
            "752f073c9b327f42",
            "c31b3f586efc5c75"
        ],
        "x": 55,
        "y": 440,
        "wires": [
            [
                "33b523d447c86f23"
            ]
        ],
        "outputLabels": [
            "topic = uri, payload = body, method = HTTP request type"
        ]
    },
    {
        "id": "33b523d447c86f23",
        "type": "subflow:5785c8d9f39df67e",
        "z": "810a8b527afd2b1b",
        "g": "cde8d276df445e2f",
        "name": "",
        "env": [
            {
                "name": "ADDRESS",
                "value": "BASEMENT_HUE_ADDRESS",
                "type": "env"
            },
            {
                "name": "KEY",
                "value": "BASEMENT_HUE_KEY",
                "type": "env"
            }
        ],
        "x": 190,
        "y": 440,
        "wires": [
            [
                "a2c690258588b4d5"
            ]
        ]
    },
    {
        "id": "608e6356fbb9f384",
        "type": "inject",
        "z": "810a8b527afd2b1b",
        "g": "e7188f251e14aea1",
        "name": "create key",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 120,
        "y": 100,
        "wires": [
            [
                "a12bdbda86868f06"
            ]
        ]
    },
    {
        "id": "26973bac8c6a9dba",
        "type": "debug",
        "z": "810a8b527afd2b1b",
        "g": "e7188f251e14aea1",
        "name": "basement hue application key",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": true,
        "complete": "true",
        "targetType": "full",
        "statusVal": "payload[0].success.username",
        "statusType": "msg",
        "x": 590,
        "y": 100,
        "wires": []
    },
    {
        "id": "a12bdbda86868f06",
        "type": "subflow:75bc72a16c4da2c8",
        "z": "810a8b527afd2b1b",
        "g": "e7188f251e14aea1",
        "name": "",
        "env": [
            {
                "name": "ADDRESS",
                "value": "BASEMENT_HUE_ADDRESS",
                "type": "env"
            },
            {
                "name": "USERNAME",
                "value": "nodered#basementhue",
                "type": "str"
            }
        ],
        "x": 320,
        "y": 100,
        "wires": [
            [
                "26973bac8c6a9dba"
            ]
        ]
    },
    {
        "id": "bddbce9f11c0ea01",
        "type": "comment",
        "z": "810a8b527afd2b1b",
        "g": "e7188f251e14aea1",
        "name": "use this to create the value to pass as the ${KEY} parameter in various subflows",
        "info": "",
        "x": 320,
        "y": 60,
        "wires": []
    },
    {
        "id": "678145510dc4c76f",
        "type": "inject",
        "z": "810a8b527afd2b1b",
        "g": "4e52881346c9e44b",
        "name": "at start",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "4",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 120,
        "y": 220,
        "wires": [
            [
                "d638e45951bb8819"
            ]
        ]
    },
    {
        "id": "d638e45951bb8819",
        "type": "ui_button",
        "z": "810a8b527afd2b1b",
        "g": "4e52881346c9e44b",
        "name": "Refresh Basement Hue Controls",
        "group": "178c0c0ade9cbfc5",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": true,
        "label": "Refresh",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "fa-refresh",
        "payload": "",
        "payloadType": "date",
        "topic": "topic",
        "topicType": "msg",
        "x": 330,
        "y": 220,
        "wires": [
            [
                "eba8e1c8260d9915"
            ]
        ]
    },
    {
        "id": "eba8e1c8260d9915",
        "type": "subflow:da7c0eae8eb34f5a",
        "z": "810a8b527afd2b1b",
        "g": "4e52881346c9e44b",
        "name": "",
        "env": [
            {
                "name": "ADDRESS",
                "value": "BASEMENT_HUE_ADDRESS",
                "type": "env"
            },
            {
                "name": "KEY",
                "value": "BASEMENT_HUE_KEY",
                "type": "env"
            },
            {
                "name": "TOPIC",
                "value": "BASEMENT_HUE_TOPIC",
                "type": "env"
            },
            {
                "name": "TARGET",
                "value": "send to basement hue",
                "type": "str"
            }
        ],
        "x": 570,
        "y": 220,
        "wires": [
            [
                "01dabb1829a3e85e"
            ],
            [
                "ab63a9de566fc346"
            ]
        ]
    },
    {
        "id": "7dcd1d246a096330",
        "type": "subflow:4e89e7c952d56c09",
        "z": "810a8b527afd2b1b",
        "g": "599f55425211e232",
        "name": "",
        "env": [
            {
                "name": "ADDRESS",
                "value": "BASEMENT_HUE_ADDRESS",
                "type": "env"
            },
            {
                "name": "KEY",
                "value": "BASEMENT_HUE_KEY",
                "type": "env"
            },
            {
                "name": "TOPIC",
                "value": "BASEMENT_HUE_TOPIC",
                "type": "env"
            }
        ],
        "x": 110,
        "y": 540,
        "wires": [
            [
                "968fd6d85ac60a62"
            ]
        ]
    },
    {
        "id": "968fd6d85ac60a62",
        "type": "link out",
        "z": "810a8b527afd2b1b",
        "g": "599f55425211e232",
        "name": "send to broker",
        "mode": "link",
        "links": [
            "b9100b6a29fef164",
            "efbd1b79e54e0bf7"
        ],
        "x": 215,
        "y": 540,
        "wires": []
    },
    {
        "id": "a2c690258588b4d5",
        "type": "subflow:7b61502c01a97f85",
        "z": "810a8b527afd2b1b",
        "g": "cde8d276df445e2f",
        "name": "",
        "x": 390,
        "y": 440,
        "wires": []
    },
    {
        "id": "ab63a9de566fc346",
        "type": "subflow:7b61502c01a97f85",
        "z": "810a8b527afd2b1b",
        "g": "4e52881346c9e44b",
        "name": "",
        "x": 770,
        "y": 240,
        "wires": []
    },
    {
        "id": "40ce873d4a67d8f4",
        "type": "subflow:882c6d268bfa1aec",
        "z": "810a8b527afd2b1b",
        "g": "74df0c542b5a3bbd",
        "name": "",
        "env": [
            {
                "name": "TOPIC",
                "value": "hue/basement-hue/grouped_light/+",
                "type": "str"
            }
        ],
        "x": 150,
        "y": 340,
        "wires": [
            [
                "6d75fc9fc3d3a168"
            ]
        ]
    },
    {
        "id": "6d75fc9fc3d3a168",
        "type": "ui_template",
        "z": "810a8b527afd2b1b",
        "g": "74df0c542b5a3bbd",
        "group": "178c0c0ade9cbfc5",
        "name": "Basement Hue Controls",
        "order": 2,
        "width": "6",
        "height": "15",
        "format": "",
        "storeOutMessages": false,
        "fwdInMessages": false,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 390,
        "y": 340,
        "wires": [
            [
                "c31b3f586efc5c75"
            ]
        ]
    },
    {
        "id": "c31b3f586efc5c75",
        "type": "link out",
        "z": "810a8b527afd2b1b",
        "g": "74df0c542b5a3bbd",
        "name": "send to basement hue",
        "mode": "link",
        "links": [
            "64274eb0d8b9e5dd"
        ],
        "x": 535,
        "y": 340,
        "wires": []
    },
    {
        "id": "01dabb1829a3e85e",
        "type": "link out",
        "z": "810a8b527afd2b1b",
        "g": "4e52881346c9e44b",
        "name": "link out 1",
        "mode": "link",
        "links": [
            "efbd1b79e54e0bf7"
        ],
        "x": 695,
        "y": 200,
        "wires": []
    },
    {
        "id": "2f6cc09457939ce2",
        "type": "subflow:9c4e4702e4660adf",
        "z": "1cf0490e7de2f93d",
        "g": "87285e6bf01cff03",
        "name": "",
        "env": [
            {
                "name": "ADDRESS",
                "value": "POWERVIEW_ADDRESS",
                "type": "env"
            }
        ],
        "x": 220,
        "y": 200,
        "wires": [
            [
                "63300052daf495e4"
            ]
        ]
    },
    {
        "id": "7173aa38c9fa93dc",
        "type": "link in",
        "z": "1cf0490e7de2f93d",
        "g": "87285e6bf01cff03",
        "name": "activate powerview scene",
        "links": [
            "9f3d946a03de6aa8",
            "676c095bc7abab1e",
            "92a8459af7433d08",
            "d6caf0385ddcc934",
            "094c793f3a335844",
            "14f75f22c0a890cc",
            "4e5a85bfe405e198",
            "49039ff17e845f97",
            "96e7a29d96084487",
            "dcd2a91c5972ccf0"
        ],
        "x": 55,
        "y": 200,
        "wires": [
            [
                "2f6cc09457939ce2"
            ]
        ]
    },
    {
        "id": "942f0a1ef3d8ade3",
        "type": "subflow:bdefba026bd44159",
        "z": "1cf0490e7de2f93d",
        "g": "b48f76e13fc77aa7",
        "name": "",
        "env": [
            {
                "name": "ADDRESS",
                "value": "POWERVIEW_ADDRESS",
                "type": "env"
            }
        ],
        "x": 600,
        "y": 80,
        "wires": [
            [
                "85c26fe91dc71759"
            ],
            [
                "85e6e4e1fe740e1b"
            ]
        ]
    },
    {
        "id": "85c26fe91dc71759",
        "type": "ui_template",
        "z": "1cf0490e7de2f93d",
        "g": "b48f76e13fc77aa7",
        "group": "e3fcd4654cf9f3fc",
        "name": "Window Shade Controls",
        "order": 2,
        "width": "6",
        "height": "7",
        "format": "",
        "storeOutMessages": false,
        "fwdInMessages": false,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 850,
        "y": 60,
        "wires": [
            [
                "96e7a29d96084487"
            ]
        ]
    },
    {
        "id": "75bff418d99b8d56",
        "type": "inject",
        "z": "1cf0490e7de2f93d",
        "g": "b48f76e13fc77aa7",
        "name": "at start",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "5",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 120,
        "y": 80,
        "wires": [
            [
                "7026f2de142e8ef2"
            ]
        ]
    },
    {
        "id": "7026f2de142e8ef2",
        "type": "ui_button",
        "z": "1cf0490e7de2f93d",
        "g": "b48f76e13fc77aa7",
        "name": "Referesh PowerView Metadata",
        "group": "e3fcd4654cf9f3fc",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": true,
        "label": "Refresh",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "fa-refresh",
        "payload": "",
        "payloadType": "date",
        "topic": "topic",
        "topicType": "msg",
        "x": 330,
        "y": 80,
        "wires": [
            [
                "942f0a1ef3d8ade3"
            ]
        ]
    },
    {
        "id": "71f42f61777d49d9",
        "type": "link in",
        "z": "1cf0490e7de2f93d",
        "g": "0770b0ba393f379d",
        "name": "close all shades",
        "links": [
            "08388db8f103b3a6",
            "fa1ec72a4270321c",
            "4a69e032bf396637",
            "0b72197569340d63",
            "5a10fc701135b50d"
        ],
        "x": 155,
        "y": 300,
        "wires": [
            [
                "16c6de044f949382"
            ]
        ]
    },
    {
        "id": "16c6de044f949382",
        "type": "change",
        "z": "1cf0490e7de2f93d",
        "g": "0770b0ba393f379d",
        "name": "close all shades",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "15208",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 300,
        "y": 300,
        "wires": [
            [
                "dcd2a91c5972ccf0"
            ]
        ]
    },
    {
        "id": "4d9c62d6c2145813",
        "type": "link in",
        "z": "1cf0490e7de2f93d",
        "g": "0770b0ba393f379d",
        "name": "open all shades",
        "links": [
            "852b9ed1563a9966",
            "83801674771348bb",
            "cbfb68d15d64faa7",
            "7bb24887e8a01399",
            "06d9f4b53b9bbb6e",
            "5a5a3cf0e990c640",
            "cb25d319d7126480",
            "fc34e1d6c55a3985",
            "92c2876f08baadd9",
            "5638c682e2ac2fba"
        ],
        "x": 155,
        "y": 340,
        "wires": [
            [
                "4f656e2b5766e68f"
            ]
        ]
    },
    {
        "id": "4f656e2b5766e68f",
        "type": "change",
        "z": "1cf0490e7de2f93d",
        "g": "0770b0ba393f379d",
        "name": "open all shades",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "7307",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 300,
        "y": 340,
        "wires": [
            [
                "dcd2a91c5972ccf0"
            ]
        ],
        "info": "// nrlint no-overlapping-nodes:off\n"
    },
    {
        "id": "cab89ebfeca22623",
        "type": "link in",
        "z": "1cf0490e7de2f93d",
        "g": "0770b0ba393f379d",
        "name": "morning shades",
        "links": [
            "b13e36ae61e678c5"
        ],
        "x": 155,
        "y": 380,
        "wires": [
            [
                "a0e918936b64e067"
            ]
        ]
    },
    {
        "id": "a0e918936b64e067",
        "type": "change",
        "z": "1cf0490e7de2f93d",
        "g": "0770b0ba393f379d",
        "name": "morning shades",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "56393",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 300,
        "y": 380,
        "wires": [
            [
                "dcd2a91c5972ccf0"
            ]
        ],
        "info": "// nrlint no-overlapping-nodes:off\n"
    },
    {
        "id": "3fa2af1c1f32f8ee",
        "type": "link in",
        "z": "1cf0490e7de2f93d",
        "g": "0770b0ba393f379d",
        "name": "afternoon shades",
        "links": [
            "55f89a635c93f337"
        ],
        "x": 155,
        "y": 420,
        "wires": [
            [
                "1fcfbbdf6167f8c8"
            ]
        ]
    },
    {
        "id": "1fcfbbdf6167f8c8",
        "type": "change",
        "z": "1cf0490e7de2f93d",
        "g": "0770b0ba393f379d",
        "name": "afternoon shades",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "42686",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 290,
        "y": 420,
        "wires": [
            [
                "dcd2a91c5972ccf0"
            ]
        ]
    },
    {
        "id": "63300052daf495e4",
        "type": "subflow:7b61502c01a97f85",
        "z": "1cf0490e7de2f93d",
        "g": "87285e6bf01cff03",
        "name": "",
        "x": 450,
        "y": 200,
        "wires": []
    },
    {
        "id": "85e6e4e1fe740e1b",
        "type": "subflow:7b61502c01a97f85",
        "z": "1cf0490e7de2f93d",
        "g": "b48f76e13fc77aa7",
        "name": "",
        "x": 830,
        "y": 100,
        "wires": []
    },
    {
        "id": "96e7a29d96084487",
        "type": "link out",
        "z": "1cf0490e7de2f93d",
        "g": "b48f76e13fc77aa7",
        "name": "activate powerview scene",
        "mode": "link",
        "links": [
            "7173aa38c9fa93dc"
        ],
        "x": 995,
        "y": 60,
        "wires": []
    },
    {
        "id": "dcd2a91c5972ccf0",
        "type": "link out",
        "z": "1cf0490e7de2f93d",
        "g": "0770b0ba393f379d",
        "name": "activate powerview scene",
        "mode": "link",
        "links": [
            "7173aa38c9fa93dc"
        ],
        "x": 455,
        "y": 360,
        "wires": []
    },
    {
        "id": "c27168b168847790",
        "type": "ui_chart",
        "z": "b12fd38c090c51f2",
        "g": "b438e0cbd64ef6ce",
        "name": "Sun Position",
        "group": "8055574ccb17e8ed",
        "order": 3,
        "width": "6",
        "height": "6",
        "label": "",
        "chartType": "line",
        "legend": "true",
        "xformat": "HH:mm",
        "interpolate": "linear",
        "nodata": "",
        "dot": false,
        "ymin": "-3.14159",
        "ymax": "3.14159",
        "removeOlder": 1,
        "removeOlderPoints": "1000",
        "removeOlderUnit": "86400",
        "cutout": 0,
        "useOneColor": false,
        "useUTC": false,
        "colors": [
            "#1f77b4",
            "#aec7e8",
            "#ff7f0e",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "outputs": 1,
        "useDifferentColor": false,
        "className": "",
        "x": 610,
        "y": 160,
        "wires": [
            []
        ]
    },
    {
        "id": "3a39c550369bac31",
        "type": "inject",
        "z": "b12fd38c090c51f2",
        "g": "b438e0cbd64ef6ce",
        "name": "at start",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 160,
        "y": 180,
        "wires": [
            [
                "15ce56cf1449ce52"
            ]
        ]
    },
    {
        "id": "15ce56cf1449ce52",
        "type": "ui_date_picker",
        "z": "b12fd38c090c51f2",
        "g": "b438e0cbd64ef6ce",
        "name": "",
        "label": "Date",
        "group": "8055574ccb17e8ed",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": true,
        "topic": "topic",
        "topicType": "msg",
        "className": "",
        "x": 290,
        "y": 200,
        "wires": [
            [
                "f33b94d2cc59c348"
            ]
        ]
    },
    {
        "id": "f33b94d2cc59c348",
        "type": "function",
        "z": "b12fd38c090c51f2",
        "g": "b438e0cbd64ef6ce",
        "name": "sun positions",
        "func": "/*global suncalc*/\n\nconst msg2 = RED.util.cloneMessage(msg)\nconst msg3 = RED.util.cloneMessage(msg)\nconst latitude = env.get('LATITUDE')\nconst longitude = env.get('LONGITUDE')\nconst date = new Date(msg.payload)\nconst positions = []\nconst altitudes = []\nconst azimuths = []\nconst times = suncalc.getTimes(date, latitude, longitude)\nconst sunrise = times.sunrise.getTime()\nconst sunset = times.sunset.getTime()\nconst zenith = {\n    time: 0,\n    altitude: -(Math.PI / 2),\n    azimuth: 0\n}\n\nfor (let minute = sunrise; minute < sunset; minute += 60000) {\n\n    const position = suncalc.getPosition(new Date(minute), latitude, longitude)\n\n    position.time = minute\n    positions.push(position)\n    altitudes.push({ x: minute, y: position.altitude })\n    azimuths.push({ x: minute, y: position.azimuth })\n\n    if (position.altitude > zenith.altitude) {\n\n        zenith.time = minute\n        zenith.altitude = position.altitude\n        zenith.azimuth = position.azimuth\n\n    }\n}\n\nmsg.payload = [{\n    \"series\": [\"altitude\", \"azimuth\"],\n    \"data\": [\n        altitudes,\n        azimuths\n    ],\n    \"labels\": [\"\"]\n}]\n\nmsg2.payload = zenith\nmsg3.payload = positions\n\nreturn [\n    msg,\n    msg2,\n    msg3\n]",
        "outputs": 3,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "suncalc",
                "module": "suncalc"
            }
        ],
        "x": 430,
        "y": 200,
        "wires": [
            [
                "c27168b168847790"
            ],
            [
                "4dd293c16815dce3"
            ],
            [
                "e7bc056a5ca25bc5"
            ]
        ],
        "outputLabels": [
            "chart",
            "zenith",
            "positions"
        ]
    },
    {
        "id": "f72b11239792afcf",
        "type": "ui_template",
        "z": "b12fd38c090c51f2",
        "g": "b438e0cbd64ef6ce",
        "group": "8055574ccb17e8ed",
        "name": "Zenith",
        "order": 2,
        "width": "6",
        "height": "2",
        "format": "<div>\n    <table width=\"100%\" cellspacing=\"5px\" cellpadding=\"5px\">\n        <caption>zenith</caption>\n        <tr>\n            <th>time</th>\n            <th>altitude</th>\n            <th>azimuth</th>\n        </tr>\n        <tr>\n            <td>{{msg.payload.time}}</td>\n            <td>{{msg.payload.altitude}}</td>\n            <td>{{msg.payload.azimuth}}</td>\n        </tr>\n    </table>\n</div>",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 750,
        "y": 200,
        "wires": [
            []
        ]
    },
    {
        "id": "4dd293c16815dce3",
        "type": "function",
        "z": "b12fd38c090c51f2",
        "g": "b438e0cbd64ef6ce",
        "name": "format zenith",
        "func": "/**\n* @param {number} radians\n*/\nfunction truncate(radians) {\n\n    const decimals = 10000000\n    return Math.round(radians * decimals) / decimals\n\n}\n\nmsg.payload.time = new Date(msg.payload.time).toLocaleTimeString()\nmsg.payload.altitude = truncate(msg.payload.altitude)\nmsg.payload.azimuth = truncate(msg.payload.azimuth)\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 610,
        "y": 200,
        "wires": [
            [
                "f72b11239792afcf"
            ]
        ]
    },
    {
        "id": "3ffae20118b3f324",
        "type": "ui_text",
        "z": "b12fd38c090c51f2",
        "g": "8a81267cb12384d5",
        "group": "25c7f0078ed443dd",
        "order": 4,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Sunrise",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 360,
        "y": 460,
        "wires": []
    },
    {
        "id": "056b4e63ec2cd405",
        "type": "ui_text",
        "z": "b12fd38c090c51f2",
        "g": "8a81267cb12384d5",
        "group": "25c7f0078ed443dd",
        "order": 8,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Sunset",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 760,
        "y": 460,
        "wires": []
    },
    {
        "id": "64f954fed4bbe73e",
        "type": "ui_text",
        "z": "b12fd38c090c51f2",
        "g": "8a81267cb12384d5",
        "group": "25c7f0078ed443dd",
        "order": 9,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Bedtime",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 1160,
        "y": 340,
        "wires": []
    },
    {
        "id": "4332d4706a43e2f6",
        "type": "ui_text",
        "z": "b12fd38c090c51f2",
        "g": "8a81267cb12384d5",
        "group": "25c7f0078ed443dd",
        "order": 2,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Time",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 370,
        "y": 340,
        "wires": []
    },
    {
        "id": "9e522923ebcadd47",
        "type": "ui_text",
        "z": "b12fd38c090c51f2",
        "g": "8a81267cb12384d5",
        "group": "25c7f0078ed443dd",
        "order": 1,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Theme",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 360,
        "y": 400,
        "wires": []
    },
    {
        "id": "cd359e0f643d8b52",
        "type": "subflow:be201d7a24b331c5",
        "z": "b12fd38c090c51f2",
        "g": "8a81267cb12384d5",
        "name": "nodered/automation/sunrise",
        "env": [
            {
                "name": "TOPIC",
                "value": "nodered/automation/sunrise",
                "type": "str"
            }
        ],
        "x": 160,
        "y": 460,
        "wires": [
            [
                "3ffae20118b3f324"
            ]
        ]
    },
    {
        "id": "6ce0fae7a630111f",
        "type": "subflow:be201d7a24b331c5",
        "z": "b12fd38c090c51f2",
        "g": "8a81267cb12384d5",
        "name": "nodered/automation/sunset",
        "env": [
            {
                "name": "TOPIC",
                "value": "nodered/automation/sunset",
                "type": "str"
            }
        ],
        "x": 550,
        "y": 460,
        "wires": [
            [
                "056b4e63ec2cd405"
            ]
        ]
    },
    {
        "id": "6fd30861ee594f7a",
        "type": "subflow:be201d7a24b331c5",
        "z": "b12fd38c090c51f2",
        "g": "8a81267cb12384d5",
        "name": "nodered/automation/bedtime",
        "env": [
            {
                "name": "TOPIC",
                "value": "nodered/automation/bedtime",
                "type": "str"
            }
        ],
        "x": 960,
        "y": 340,
        "wires": [
            [
                "64f954fed4bbe73e"
            ]
        ]
    },
    {
        "id": "7b3880a941748a69",
        "type": "mqtt in",
        "z": "b12fd38c090c51f2",
        "g": "8a81267cb12384d5",
        "name": "",
        "topic": "nodered/automation/time",
        "qos": "2",
        "datatype": "utf8",
        "broker": "722d62f3b93039c3",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 150,
        "y": 340,
        "wires": [
            [
                "4332d4706a43e2f6"
            ]
        ]
    },
    {
        "id": "a6c27a31c49422e4",
        "type": "mqtt in",
        "z": "b12fd38c090c51f2",
        "g": "8a81267cb12384d5",
        "name": "",
        "topic": "nodered/automation/theme",
        "qos": "2",
        "datatype": "utf8",
        "broker": "722d62f3b93039c3",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 150,
        "y": 400,
        "wires": [
            [
                "9e522923ebcadd47"
            ]
        ]
    },
    {
        "id": "03b32d05f0dc98c7",
        "type": "subflow:be201d7a24b331c5",
        "z": "b12fd38c090c51f2",
        "g": "8a81267cb12384d5",
        "name": "nodered/automation/midday",
        "env": [
            {
                "name": "TOPIC",
                "value": "nodered/automation/midday",
                "type": "str"
            }
        ],
        "x": 560,
        "y": 340,
        "wires": [
            [
                "b403745b92a95d79"
            ]
        ]
    },
    {
        "id": "3a0d9afd6a91a4b8",
        "type": "subflow:be201d7a24b331c5",
        "z": "b12fd38c090c51f2",
        "g": "8a81267cb12384d5",
        "name": "nodered/automation/afternoon",
        "env": [
            {
                "name": "TOPIC",
                "value": "nodered/automation/afternoon",
                "type": "str"
            }
        ],
        "x": 560,
        "y": 400,
        "wires": [
            [
                "119dc5e83c2a078f"
            ]
        ]
    },
    {
        "id": "119dc5e83c2a078f",
        "type": "ui_text",
        "z": "b12fd38c090c51f2",
        "g": "8a81267cb12384d5",
        "group": "25c7f0078ed443dd",
        "order": 7,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Afternoon",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 760,
        "y": 400,
        "wires": []
    },
    {
        "id": "b403745b92a95d79",
        "type": "ui_text",
        "z": "b12fd38c090c51f2",
        "g": "8a81267cb12384d5",
        "group": "25c7f0078ed443dd",
        "order": 5,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Midday",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 760,
        "y": 340,
        "wires": []
    },
    {
        "id": "c6ad3ce00565e461",
        "type": "ui_text",
        "z": "b12fd38c090c51f2",
        "g": "8a81267cb12384d5",
        "group": "25c7f0078ed443dd",
        "order": 10,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Altitude",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 1160,
        "y": 400,
        "wires": []
    },
    {
        "id": "fb5206dc8bb107e5",
        "type": "ui_text",
        "z": "b12fd38c090c51f2",
        "g": "8a81267cb12384d5",
        "group": "25c7f0078ed443dd",
        "order": 11,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Azimuth",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 1160,
        "y": 460,
        "wires": []
    },
    {
        "id": "61c5be84a6996eee",
        "type": "mqtt in",
        "z": "b12fd38c090c51f2",
        "g": "8a81267cb12384d5",
        "name": "",
        "topic": "nodered/automation/altitude",
        "qos": "2",
        "datatype": "json",
        "broker": "722d62f3b93039c3",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 960,
        "y": 400,
        "wires": [
            [
                "c6ad3ce00565e461"
            ]
        ]
    },
    {
        "id": "a921a5a41ab154fc",
        "type": "mqtt in",
        "z": "b12fd38c090c51f2",
        "g": "8a81267cb12384d5",
        "name": "",
        "topic": "nodered/automation/azimuth",
        "qos": "2",
        "datatype": "json",
        "broker": "722d62f3b93039c3",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 960,
        "y": 460,
        "wires": [
            [
                "fb5206dc8bb107e5"
            ]
        ]
    },
    {
        "id": "8fe5e01fe99f5026",
        "type": "inject",
        "z": "b12fd38c090c51f2",
        "g": "b438e0cbd64ef6ce",
        "name": "every morning",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "00 04 * * *",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 140,
        "y": 220,
        "wires": [
            [
                "15ce56cf1449ce52"
            ]
        ]
    },
    {
        "id": "e7bc056a5ca25bc5",
        "type": "change",
        "z": "b12fd38c090c51f2",
        "g": "b438e0cbd64ef6ce",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "sun-positions",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 650,
        "y": 240,
        "wires": [
            [
                "f9a4b2c24da44638"
            ]
        ]
    },
    {
        "id": "f9a4b2c24da44638",
        "type": "function",
        "z": "b12fd38c090c51f2",
        "g": "b438e0cbd64ef6ce",
        "name": "url",
        "func": "/*global os*/\n\nmsg.payload = 'http://' + os.hostname + '.local:1880/sunpositions'\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "os",
                "module": "os"
            }
        ],
        "x": 830,
        "y": 240,
        "wires": [
            [
                "eb296b561972b772"
            ]
        ]
    },
    {
        "id": "eb296b561972b772",
        "type": "ui_template",
        "z": "b12fd38c090c51f2",
        "g": "b438e0cbd64ef6ce",
        "group": "8055574ccb17e8ed",
        "name": "Download CSV",
        "order": 4,
        "width": 0,
        "height": 0,
        "format": "<div style=\"width:100%;text-align:center;\">\n    <a style=\"color:white;text-decoration:none;\" href=\"{{msg.payload}}\">Download</a>\n</div>",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "className": "",
        "x": 980,
        "y": 240,
        "wires": [
            []
        ]
    },
    {
        "id": "8b169767a6b4cbd9",
        "type": "http response",
        "z": "b12fd38c090c51f2",
        "g": "4b0f721c48fca435",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 950,
        "y": 60,
        "wires": []
    },
    {
        "id": "dbca9a86d3bcf1ec",
        "type": "function",
        "z": "b12fd38c090c51f2",
        "g": "4b0f721c48fca435",
        "name": "response",
        "func": "const date = new Date()\nconst timestamp = '-' +\n    date.getFullYear() +\n    '-' +\n    String(date.getMonth() + 1).padStart(2, '0') +\n    '-' +\n    String(date.getDate()).padStart(2, '0')\n\nmsg.headers = {\n    'Content-Type': 'text/plain; charset=UTF-8',\n    'Content-Disposition': 'attachment; filename=\"sun-positions' + timestamp + '.csv\"'\n}\n\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 820,
        "y": 60,
        "wires": [
            [
                "8b169767a6b4cbd9"
            ]
        ]
    },
    {
        "id": "f33c29023f26968a",
        "type": "http in",
        "z": "b12fd38c090c51f2",
        "g": "4b0f721c48fca435",
        "name": "",
        "url": "/sunpositions",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 130,
        "y": 60,
        "wires": [
            [
                "ba54b4d206406127"
            ]
        ]
    },
    {
        "id": "8d0db05f4d495979",
        "type": "csv",
        "z": "b12fd38c090c51f2",
        "g": "4b0f721c48fca435",
        "name": "",
        "sep": ",",
        "hdrin": "",
        "hdrout": "all",
        "multi": "one",
        "ret": "\\n",
        "temp": "time,altitude,azimuth",
        "skip": "0",
        "strings": true,
        "include_empty_strings": "",
        "include_null_values": "",
        "x": 690,
        "y": 60,
        "wires": [
            [
                "dbca9a86d3bcf1ec"
            ]
        ]
    },
    {
        "id": "ba54b4d206406127",
        "type": "change",
        "z": "b12fd38c090c51f2",
        "g": "4b0f721c48fca435",
        "name": "global.sun-positions",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "sun-positions",
                "tot": "global"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 340,
        "y": 60,
        "wires": [
            [
                "b1ebe60c0c09e6c1"
            ]
        ]
    },
    {
        "id": "b1ebe60c0c09e6c1",
        "type": "function",
        "z": "b12fd38c090c51f2",
        "g": "4b0f721c48fca435",
        "name": "format for csv",
        "func": "msg.payload.forEach((/** @type {{ time: string | number | Date; }} */ position) => {\n\n    position.time = new Date(position.time).toLocaleTimeString()\n\n})\n\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 540,
        "y": 60,
        "wires": [
            [
                "8d0db05f4d495979"
            ]
        ]
    },
    {
        "id": "02ea0683c75f69c5",
        "type": "ui_text",
        "z": "b12fd38c090c51f2",
        "g": "1654aea0ccd3a289",
        "group": "a0da6d89d75fc6ac",
        "order": 1,
        "width": 0,
        "height": 0,
        "name": "Basement Hue readyState",
        "label": "readyState",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 1080,
        "y": 560,
        "wires": []
    },
    {
        "id": "70078a31791fbbc5",
        "type": "subflow:9601cbf2386d897b",
        "z": "b12fd38c090c51f2",
        "g": "1654aea0ccd3a289",
        "name": "Count Basement Hue onopen",
        "env": [
            {
                "name": "TOPIC",
                "value": "${BASEMENT_HUE_TOPIC}/open",
                "type": "env"
            }
        ],
        "x": 820,
        "y": 620,
        "wires": [
            [],
            [
                "b419f6a87901aa7d"
            ]
        ]
    },
    {
        "id": "b419f6a87901aa7d",
        "type": "ui_text",
        "z": "b12fd38c090c51f2",
        "g": "1654aea0ccd3a289",
        "group": "a0da6d89d75fc6ac",
        "order": 2,
        "width": 0,
        "height": 0,
        "name": "Basement Hue onopen Count",
        "label": "onopen",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 1090,
        "y": 620,
        "wires": []
    },
    {
        "id": "c87b61478949025d",
        "type": "subflow:9601cbf2386d897b",
        "z": "b12fd38c090c51f2",
        "g": "1654aea0ccd3a289",
        "name": "Basement Hue Status",
        "env": [
            {
                "name": "TOPIC",
                "value": "${BASEMENT_HUE_TOPIC}/status",
                "type": "env"
            }
        ],
        "x": 840,
        "y": 560,
        "wires": [
            [
                "02ea0683c75f69c5"
            ],
            []
        ]
    },
    {
        "id": "f824597938fe8446",
        "type": "ui_text",
        "z": "b12fd38c090c51f2",
        "g": "7a60f981743e0c00",
        "group": "03b0e40844d33477",
        "order": 1,
        "width": 0,
        "height": 0,
        "name": "Ground Floor Hue readyState",
        "label": "readyState",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 450,
        "y": 560,
        "wires": []
    },
    {
        "id": "362e8e438951f6f5",
        "type": "subflow:9601cbf2386d897b",
        "z": "b12fd38c090c51f2",
        "g": "7a60f981743e0c00",
        "name": "Count Ground Floor Hue onopen",
        "env": [
            {
                "name": "TOPIC",
                "value": "${GROUND_FLOOR_HUE_TOPIC}/open",
                "type": "env"
            }
        ],
        "x": 170,
        "y": 620,
        "wires": [
            [],
            [
                "b016ab17f51ffdc7"
            ]
        ]
    },
    {
        "id": "b016ab17f51ffdc7",
        "type": "ui_text",
        "z": "b12fd38c090c51f2",
        "g": "7a60f981743e0c00",
        "group": "03b0e40844d33477",
        "order": 2,
        "width": 0,
        "height": 0,
        "name": "Ground Floor Hue onopen Count",
        "label": "onopen",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 460,
        "y": 620,
        "wires": []
    },
    {
        "id": "ed8b62a9f546bb94",
        "type": "subflow:9601cbf2386d897b",
        "z": "b12fd38c090c51f2",
        "g": "7a60f981743e0c00",
        "name": "Ground Floor Hue Status",
        "env": [
            {
                "name": "TOPIC",
                "value": "${GROUND_FLOOR_HUE_TOPIC}/status",
                "type": "env"
            }
        ],
        "x": 190,
        "y": 560,
        "wires": [
            [
                "f824597938fe8446"
            ],
            []
        ]
    }
]